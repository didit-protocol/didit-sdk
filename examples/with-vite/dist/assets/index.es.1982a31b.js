var mo=Object.defineProperty;var fs=Object.getOwnPropertySymbols;var vo=Object.prototype.hasOwnProperty,Eo=Object.prototype.propertyIsEnumerable;var ds=(i,e,t)=>e in i?mo(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ee=(i,e)=>{for(var t in e||(e={}))vo.call(e,t)&&ds(i,t,e[t]);if(fs)for(var t of fs(e))Eo.call(e,t)&&ds(i,t,e[t]);return i};import{t as bt,e as At,I as Nr}from"./tslib.31db49d6.js";import{c as qt,g as Do,f as So}from"./index.48221487.js";import{e as Tr,c as xo,s as Io,a as Oo,d as Ao,g as Co,h as Po,i as yn,j as ps,b as No,k as To,l as bn,f as Rr,m as Ro,J as fi,n as Fr,o as Ur,q as Rt,r as Ot,t as wn,u as Lr,H as zi}from"./index.13cd4879.js";import{r as Fo}from"./___vite-browser-external_commonjs-proxy.e32fef6d.js";function Uo(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}var Lo=Mo;function Mo(i,e,t){var r=t&&t.stringify||Uo,s=1;if(typeof i=="object"&&i!==null){var o=e.length+s;if(o===1)return i;var u=new Array(o);u[0]=r(i);for(var c=1;c<o;c++)u[c]=r(e[c]);return u.join(" ")}if(typeof i!="string")return i;var h=e.length;if(h===0)return i;for(var p="",y=1-s,x=-1,P=i&&i.length||0,E=0;E<P;){if(i.charCodeAt(E)===37&&E+1<P){switch(x=x>-1?x:0,i.charCodeAt(E+1)){case 100:case 102:if(y>=h||e[y]==null)break;x<E&&(p+=i.slice(x,E)),p+=Number(e[y]),x=E+2,E++;break;case 105:if(y>=h||e[y]==null)break;x<E&&(p+=i.slice(x,E)),p+=Math.floor(Number(e[y])),x=E+2,E++;break;case 79:case 111:case 106:if(y>=h||e[y]===void 0)break;x<E&&(p+=i.slice(x,E));var D=typeof e[y];if(D==="string"){p+="'"+e[y]+"'",x=E+2,E++;break}if(D==="function"){p+=e[y].name||"<anonymous>",x=E+2,E++;break}p+=r(e[y]),x=E+2,E++;break;case 115:if(y>=h)break;x<E&&(p+=i.slice(x,E)),p+=String(e[y]),x=E+2,E++;break;case 37:x<E&&(p+=i.slice(x,E)),p+="%",x=E+2,E++,y--;break}++y}++E}return x===-1?i:(x<P&&(p+=i.slice(x)),p)}const gs=Lo;var di=Dt;const hi=ko().console||{},$o={mapHttpRequest:Pi,mapHttpResponse:Pi,wrapRequestSerializer:sr,wrapResponseSerializer:sr,wrapErrorSerializer:sr,req:Pi,res:Pi,err:Ko};function jo(i,e){return Array.isArray(i)?i.filter(function(r){return r!=="!stdSerializers.err"}):i===!0?Object.keys(e):!1}function Dt(i){i=i||{},i.browser=i.browser||{};const e=i.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const t=i.browser.write||hi;i.browser.write&&(i.browser.asObject=!0);const r=i.serializers||{},s=jo(i.browser.serialize,r);let o=i.browser.serialize;Array.isArray(i.browser.serialize)&&i.browser.serialize.indexOf("!stdSerializers.err")>-1&&(o=!1);const u=["error","fatal","warn","info","debug","trace"];typeof t=="function"&&(t.error=t.fatal=t.warn=t.info=t.debug=t.trace=t),i.enabled===!1&&(i.level="silent");const c=i.level||"info",h=Object.create(t);h.log||(h.log=ui),Object.defineProperty(h,"levelVal",{get:y}),Object.defineProperty(h,"level",{get:x,set:P});const p={transmit:e,serialize:s,asObject:i.browser.asObject,levels:u,timestamp:qo(i)};h.levels=Dt.levels,h.level=c,h.setMaxListeners=h.getMaxListeners=h.emit=h.addListener=h.on=h.prependListener=h.once=h.prependOnceListener=h.removeListener=h.removeAllListeners=h.listeners=h.listenerCount=h.eventNames=h.write=h.flush=ui,h.serializers=r,h._serialize=s,h._stdErrSerialize=o,h.child=E,e&&(h._logEvent=dr());function y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function x(){return this._level}function P(D){if(D!=="silent"&&!this.levels.values[D])throw Error("unknown level "+D);this._level=D,Yt(p,h,"error","log"),Yt(p,h,"fatal","error"),Yt(p,h,"warn","error"),Yt(p,h,"info","log"),Yt(p,h,"debug","log"),Yt(p,h,"trace","log")}function E(D,F){if(!D)throw new Error("missing bindings for child Pino");F=F||{},s&&D.serializers&&(F.serializers=D.serializers);const N=F.serializers;if(s&&N){var M=Object.assign({},r,N),_=i.browser.serialize===!0?Object.keys(M):s;delete D.serializers,Hi([D],_,M,this._stdErrSerialize)}function S(d){this._childLevel=(d._childLevel|0)+1,this.error=Jt(d,D,"error"),this.fatal=Jt(d,D,"fatal"),this.warn=Jt(d,D,"warn"),this.info=Jt(d,D,"info"),this.debug=Jt(d,D,"debug"),this.trace=Jt(d,D,"trace"),M&&(this.serializers=M,this._serialize=_),e&&(this._logEvent=dr([].concat(d._logEvent.bindings,D)))}return S.prototype=this,new S(this)}return h}Dt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Dt.stdSerializers=$o;Dt.stdTimeFunctions=Object.assign({},{nullTime:_n,epochTime:mn,unixTime:Vo,isoTime:Go});function Yt(i,e,t,r){const s=Object.getPrototypeOf(e);e[t]=e.levelVal>e.levels.values[t]?ui:s[t]?s[t]:hi[t]||hi[r]||ui,zo(i,e,t)}function zo(i,e,t){!i.transmit&&e[t]===ui||(e[t]=function(r){return function(){const o=i.timestamp(),u=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===hi?hi:this;for(var h=0;h<u.length;h++)u[h]=arguments[h];if(i.serialize&&!i.asObject&&Hi(u,this._serialize,this.serializers,this._stdErrSerialize),i.asObject?r.call(c,Ho(this,t,u,o)):r.apply(c,u),i.transmit){const p=i.transmit.level||e.level,y=Dt.levels.values[p],x=Dt.levels.values[t];if(x<y)return;Bo(this,{ts:o,methodLevel:t,methodValue:x,transmitLevel:p,transmitValue:Dt.levels.values[i.transmit.level||e.level],send:i.transmit.send,val:e.levelVal},u)}}}(e[t]))}function Ho(i,e,t,r){i._serialize&&Hi(t,i._serialize,i.serializers,i._stdErrSerialize);const s=t.slice();let o=s[0];const u={};r&&(u.time=r),u.level=Dt.levels.values[e];let c=(i._childLevel|0)+1;if(c<1&&(c=1),o!==null&&typeof o=="object"){for(;c--&&typeof s[0]=="object";)Object.assign(u,s.shift());o=s.length?gs(s.shift(),s):void 0}else typeof o=="string"&&(o=gs(s.shift(),s));return o!==void 0&&(u.msg=o),u}function Hi(i,e,t,r){for(const s in i)if(r&&i[s]instanceof Error)i[s]=Dt.stdSerializers.err(i[s]);else if(typeof i[s]=="object"&&!Array.isArray(i[s]))for(const o in i[s])e&&e.indexOf(o)>-1&&o in t&&(i[s][o]=t[o](i[s][o]))}function Jt(i,e,t){return function(){const r=new Array(1+arguments.length);r[0]=e;for(var s=1;s<r.length;s++)r[s]=arguments[s-1];return i[t].apply(this,r)}}function Bo(i,e,t){const r=e.send,s=e.ts,o=e.methodLevel,u=e.methodValue,c=e.val,h=i._logEvent.bindings;Hi(t,i._serialize||Object.keys(i.serializers),i.serializers,i._stdErrSerialize===void 0?!0:i._stdErrSerialize),i._logEvent.ts=s,i._logEvent.messages=t.filter(function(p){return h.indexOf(p)===-1}),i._logEvent.level.label=o,i._logEvent.level.value=u,r(o,i._logEvent,c),i._logEvent=dr(h)}function dr(i){return{ts:0,messages:[],bindings:i||[],level:{label:"",value:0}}}function Ko(i){const e={type:i.constructor.name,msg:i.message,stack:i.stack};for(const t in i)e[t]===void 0&&(e[t]=i[t]);return e}function qo(i){return typeof i.timestamp=="function"?i.timestamp:i.timestamp===!1?_n:mn}function Pi(){return{}}function sr(i){return i}function ui(){}function _n(){return!1}function mn(){return Date.now()}function Vo(){return Math.round(Date.now()/1e3)}function Go(){return new Date(Date.now()).toISOString()}function ko(){function i(e){return typeof e!="undefined"&&e}try{return typeof globalThis!="undefined"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return i(self)||i(window)||i(this)||{}}}var Bi={},pi={};Object.defineProperty(pi,"__esModule",{value:!0});function Wo(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return JSON.parse(i)}catch{return i}}pi.safeJsonParse=Wo;function Yo(i){return typeof i=="string"?i:JSON.stringify(i,(e,t)=>typeof t=="undefined"?null:t)}pi.safeJsonStringify=Yo;var Fi={exports:{}};(function(){let i;function e(){}i=e,i.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},i.prototype.setItem=function(t,r){this[t]=String(r)},i.prototype.removeItem=function(t){delete this[t]},i.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},i.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof qt!="undefined"&&qt.localStorage?Fi.exports=qt.localStorage:typeof window!="undefined"&&window.localStorage?Fi.exports=window.localStorage:Fi.exports=new e})();var vn={},Ki={};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.IKeyValueStorage=void 0;class Jo{}Ki.IKeyValueStorage=Jo;var qi={};Object.defineProperty(qi,"__esModule",{value:!0});qi.parseEntry=void 0;const Xo=pi;function Zo(i){var e;return[i[0],Xo.safeJsonParse((e=i[1])!==null&&e!==void 0?e:"")]}qi.parseEntry=Zo;(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Ki,i),e.__exportStar(qi,i)})(vn);Object.defineProperty(Bi,"__esModule",{value:!0});Bi.KeyValueStorage=void 0;const Xt=bt.exports,ys=pi,Qo=Xt.__importDefault(Fi.exports),ec=vn;class En{constructor(){this.localStorage=Qo.default}getKeys(){return Xt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Xt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(ec.parseEntry)})}getItem(e){return Xt.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return ys.safeJsonParse(t)})}setItem(e,t){return Xt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,ys.safeJsonStringify(t))})}removeItem(e){return Xt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Bi.KeyValueStorage=En;var tc=Bi.default=En,gi={},Vi={},Z={},Dn={},Gi={};Object.defineProperty(Gi,"__esModule",{value:!0});Gi.delay=void 0;function ic(i){return new Promise(e=>{setTimeout(()=>{e(!0)},i)})}Gi.delay=ic;var Zt={},Mr={},Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.ONE_THOUSAND=Qt.ONE_HUNDRED=void 0;Qt.ONE_HUNDRED=100;Qt.ONE_THOUSAND=1e3;var Sn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ONE_YEAR=i.FOUR_WEEKS=i.THREE_WEEKS=i.TWO_WEEKS=i.ONE_WEEK=i.THIRTY_DAYS=i.SEVEN_DAYS=i.FIVE_DAYS=i.THREE_DAYS=i.ONE_DAY=i.TWENTY_FOUR_HOURS=i.TWELVE_HOURS=i.SIX_HOURS=i.THREE_HOURS=i.ONE_HOUR=i.SIXTY_MINUTES=i.THIRTY_MINUTES=i.TEN_MINUTES=i.FIVE_MINUTES=i.ONE_MINUTE=i.SIXTY_SECONDS=i.THIRTY_SECONDS=i.TEN_SECONDS=i.FIVE_SECONDS=i.ONE_SECOND=void 0,i.ONE_SECOND=1,i.FIVE_SECONDS=5,i.TEN_SECONDS=10,i.THIRTY_SECONDS=30,i.SIXTY_SECONDS=60,i.ONE_MINUTE=i.SIXTY_SECONDS,i.FIVE_MINUTES=i.ONE_MINUTE*5,i.TEN_MINUTES=i.ONE_MINUTE*10,i.THIRTY_MINUTES=i.ONE_MINUTE*30,i.SIXTY_MINUTES=i.ONE_MINUTE*60,i.ONE_HOUR=i.SIXTY_MINUTES,i.THREE_HOURS=i.ONE_HOUR*3,i.SIX_HOURS=i.ONE_HOUR*6,i.TWELVE_HOURS=i.ONE_HOUR*12,i.TWENTY_FOUR_HOURS=i.ONE_HOUR*24,i.ONE_DAY=i.TWENTY_FOUR_HOURS,i.THREE_DAYS=i.ONE_DAY*3,i.FIVE_DAYS=i.ONE_DAY*5,i.SEVEN_DAYS=i.ONE_DAY*7,i.THIRTY_DAYS=i.ONE_DAY*30,i.ONE_WEEK=i.SEVEN_DAYS,i.TWO_WEEKS=i.ONE_WEEK*2,i.THREE_WEEKS=i.ONE_WEEK*3,i.FOUR_WEEKS=i.ONE_WEEK*4,i.ONE_YEAR=i.ONE_DAY*365})(Sn);(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Qt,i),e.__exportStar(Sn,i)})(Mr);Object.defineProperty(Zt,"__esModule",{value:!0});Zt.fromMiliseconds=Zt.toMiliseconds=void 0;const xn=Mr;function rc(i){return i*xn.ONE_THOUSAND}Zt.toMiliseconds=rc;function sc(i){return Math.floor(i/xn.ONE_THOUSAND)}Zt.fromMiliseconds=sc;(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Gi,i),e.__exportStar(Zt,i)})(Dn);var yi={};Object.defineProperty(yi,"__esModule",{value:!0});yi.Watch=void 0;class In{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){const t=this.get(e);if(typeof t.elapsed!="undefined")throw new Error(`Watch already stopped for label: ${e}`);const r=Date.now()-t.started;this.timestamps.set(e,{started:t.started,elapsed:r})}get(e){const t=this.timestamps.get(e);if(typeof t=="undefined")throw new Error(`No timestamp found for label: ${e}`);return t}elapsed(e){const t=this.get(e);return t.elapsed||Date.now()-t.started}}yi.Watch=In;yi.default=In;var On={},ki={};Object.defineProperty(ki,"__esModule",{value:!0});ki.IWatch=void 0;class nc{}ki.IWatch=nc;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),bt.exports.__exportStar(ki,i)})(On);(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Dn,i),e.__exportStar(yi,i),e.__exportStar(On,i),e.__exportStar(Mr,i)})(Z);var $r={},Wi={};class Gt{}var ac=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",IEvents:Gt}),oc=Do(ac);Object.defineProperty(Wi,"__esModule",{value:!0});Wi.IHeartBeat=void 0;const cc=oc;class hc extends cc.IEvents{constructor(e){super()}}Wi.IHeartBeat=hc;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),bt.exports.__exportStar(Wi,i)})($r);var jr={},ei={};Object.defineProperty(ei,"__esModule",{value:!0});ei.HEARTBEAT_EVENTS=ei.HEARTBEAT_INTERVAL=void 0;const uc=Z;ei.HEARTBEAT_INTERVAL=uc.FIVE_SECONDS;ei.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),bt.exports.__exportStar(ei,i)})(jr);Object.defineProperty(Vi,"__esModule",{value:!0});Vi.HeartBeat=void 0;const nr=bt.exports,lc=At.exports,fc=Z,dc=$r,ar=jr;class zr extends dc.IHeartBeat{constructor(e){super(e),this.events=new lc.EventEmitter,this.interval=ar.HEARTBEAT_INTERVAL,this.interval=(e==null?void 0:e.interval)||ar.HEARTBEAT_INTERVAL}static init(e){return nr.__awaiter(this,void 0,void 0,function*(){const t=new zr(e);return yield t.init(),t})}init(){return nr.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return nr.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),fc.toMiliseconds(this.interval))})}pulse(){this.events.emit(ar.HEARTBEAT_EVENTS.pulse)}}Vi.HeartBeat=zr;(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Vi,i),e.__exportStar($r,i),e.__exportStar(jr,i)})(gi);var xe={},Vt={};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.PINO_CUSTOM_CONTEXT_KEY=Vt.PINO_LOGGER_DEFAULTS=void 0;Vt.PINO_LOGGER_DEFAULTS={level:"info"};Vt.PINO_CUSTOM_CONTEXT_KEY="custom_context";var st={};Object.defineProperty(st,"__esModule",{value:!0});st.generateChildLogger=st.formatChildLoggerContext=st.getLoggerContext=st.setBrowserLoggerContext=st.getBrowserLoggerContext=st.getDefaultLoggerOptions=void 0;const ti=Vt;function pc(i){return Object.assign(Object.assign({},i),{level:(i==null?void 0:i.level)||ti.PINO_LOGGER_DEFAULTS.level})}st.getDefaultLoggerOptions=pc;function An(i,e=ti.PINO_CUSTOM_CONTEXT_KEY){return i[e]||""}st.getBrowserLoggerContext=An;function Cn(i,e,t=ti.PINO_CUSTOM_CONTEXT_KEY){return i[t]=e,i}st.setBrowserLoggerContext=Cn;function Pn(i,e=ti.PINO_CUSTOM_CONTEXT_KEY){let t="";return typeof i.bindings=="undefined"?t=An(i,e):t=i.bindings().context||"",t}st.getLoggerContext=Pn;function Nn(i,e,t=ti.PINO_CUSTOM_CONTEXT_KEY){const r=Pn(i,t);return r.trim()?`${r}/${e}`:e}st.formatChildLoggerContext=Nn;function gc(i,e,t=ti.PINO_CUSTOM_CONTEXT_KEY){const r=Nn(i,e,t),s=i.child({context:r});return Cn(s,r,t)}st.generateChildLogger=gc;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.pino=void 0;const e=bt.exports,t=e.__importDefault(di);Object.defineProperty(i,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Vt,i),e.__exportStar(st,i)})(xe);class yc extends Gt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class bc extends Gt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}}class wc{constructor(e,t){this.logger=e,this.core=t}}class _c extends Gt{constructor(e,t){super(),this.relayer=e,this.logger=t}}class mc extends Gt{constructor(e){super()}}class vc{constructor(e,t,r,s){this.core=e,this.logger=t,this.name=r}}class Ec extends Gt{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Dc extends Gt{constructor(e,t){super(),this.core=e,this.logger=t}}class Sc{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class xc{constructor(e){this.client=e}}var Hr={},ii={},Yi={},Ji={};Object.defineProperty(Ji,"__esModule",{value:!0});Ji.BrowserRandomSource=void 0;const bs=65536;class Ic{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self!="undefined"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let r=0;r<t.length;r+=bs)this._crypto.getRandomValues(t.subarray(r,r+Math.min(t.length-r,bs)));return t}}Ji.BrowserRandomSource=Ic;var Xi={},ut={};Object.defineProperty(ut,"__esModule",{value:!0});function Oc(i){for(var e=0;e<i.length;e++)i[e]=0;return i}ut.wipe=Oc;Object.defineProperty(Xi,"__esModule",{value:!0});Xi.NodeRandomSource=void 0;const Ac=ut;class Cc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof So!="undefined"){const e=Fo;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const r=new Uint8Array(e);for(let s=0;s<r.length;s++)r[s]=t[s];return(0,Ac.wipe)(t),r}}Xi.NodeRandomSource=Cc;Object.defineProperty(Yi,"__esModule",{value:!0});Yi.SystemRandomSource=void 0;const Pc=Ji,Nc=Xi;class Tc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Pc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Nc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Yi.SystemRandomSource=Tc;var ie={},Tn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});function e(c,h){var p=c>>>16&65535,y=c&65535,x=h>>>16&65535,P=h&65535;return y*P+(p*P+y*x<<16>>>0)|0}i.mul=Math.imul||e;function t(c,h){return c+h|0}i.add=t;function r(c,h){return c-h|0}i.sub=r;function s(c,h){return c<<h|c>>>32-h}i.rotl=s;function o(c,h){return c<<32-h|c>>>h}i.rotr=o;function u(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}i.isInteger=Number.isInteger||u,i.MAX_SAFE_INTEGER=9007199254740991,i.isSafeInteger=function(c){return i.isInteger(c)&&c>=-i.MAX_SAFE_INTEGER&&c<=i.MAX_SAFE_INTEGER}})(Tn);Object.defineProperty(ie,"__esModule",{value:!0});var Rn=Tn;function Rc(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])<<16>>16}ie.readInt16BE=Rc;function Fc(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])>>>0}ie.readUint16BE=Fc;function Uc(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])<<16>>16}ie.readInt16LE=Uc;function Lc(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])>>>0}ie.readUint16LE=Lc;function Fn(i,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=i>>>8,e[t+1]=i>>>0,e}ie.writeUint16BE=Fn;ie.writeInt16BE=Fn;function Un(i,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=i>>>0,e[t+1]=i>>>8,e}ie.writeUint16LE=Un;ie.writeInt16LE=Un;function pr(i,e){return e===void 0&&(e=0),i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}ie.readInt32BE=pr;function gr(i,e){return e===void 0&&(e=0),(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}ie.readUint32BE=gr;function yr(i,e){return e===void 0&&(e=0),i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e]}ie.readInt32LE=yr;function br(i,e){return e===void 0&&(e=0),(i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e])>>>0}ie.readUint32LE=br;function Li(i,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=i>>>24,e[t+1]=i>>>16,e[t+2]=i>>>8,e[t+3]=i>>>0,e}ie.writeUint32BE=Li;ie.writeInt32BE=Li;function Mi(i,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=i>>>0,e[t+1]=i>>>8,e[t+2]=i>>>16,e[t+3]=i>>>24,e}ie.writeUint32LE=Mi;ie.writeInt32LE=Mi;function Mc(i,e){e===void 0&&(e=0);var t=pr(i,e),r=pr(i,e+4);return t*4294967296+r-(r>>31)*4294967296}ie.readInt64BE=Mc;function $c(i,e){e===void 0&&(e=0);var t=gr(i,e),r=gr(i,e+4);return t*4294967296+r}ie.readUint64BE=$c;function jc(i,e){e===void 0&&(e=0);var t=yr(i,e),r=yr(i,e+4);return r*4294967296+t-(t>>31)*4294967296}ie.readInt64LE=jc;function zc(i,e){e===void 0&&(e=0);var t=br(i,e),r=br(i,e+4);return r*4294967296+t}ie.readUint64LE=zc;function Ln(i,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Li(i/4294967296>>>0,e,t),Li(i>>>0,e,t+4),e}ie.writeUint64BE=Ln;ie.writeInt64BE=Ln;function Mn(i,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Mi(i>>>0,e,t),Mi(i/4294967296>>>0,e,t+4),e}ie.writeUint64LE=Mn;ie.writeInt64LE=Mn;function Hc(i,e,t){if(t===void 0&&(t=0),i%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(i/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,s=1,o=i/8+t-1;o>=t;o--)r+=e[o]*s,s*=256;return r}ie.readUintBE=Hc;function Bc(i,e,t){if(t===void 0&&(t=0),i%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(i/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,s=1,o=t;o<t+i/8;o++)r+=e[o]*s,s*=256;return r}ie.readUintLE=Bc;function Kc(i,e,t,r){if(t===void 0&&(t=new Uint8Array(i/8)),r===void 0&&(r=0),i%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Rn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=i/8+r-1;o>=r;o--)t[o]=e/s&255,s*=256;return t}ie.writeUintBE=Kc;function qc(i,e,t,r){if(t===void 0&&(t=new Uint8Array(i/8)),r===void 0&&(r=0),i%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Rn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=r;o<r+i/8;o++)t[o]=e/s&255,s*=256;return t}ie.writeUintLE=qc;function Vc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat32(e)}ie.readFloat32BE=Vc;function Gc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat32(e,!0)}ie.readFloat32LE=Gc;function kc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat64(e)}ie.readFloat64BE=kc;function Wc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat64(e,!0)}ie.readFloat64LE=Wc;function Yc(i,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(t,i),e}ie.writeFloat32BE=Yc;function Jc(i,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(t,i,!0),e}ie.writeFloat32LE=Jc;function Xc(i,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(t,i),e}ie.writeFloat64BE=Xc;function Zc(i,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(t,i,!0),e}ie.writeFloat64LE=Zc;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.randomStringForEntropy=i.randomString=i.randomUint32=i.randomBytes=i.defaultRandomSource=void 0;const e=Yi,t=ie,r=ut;i.defaultRandomSource=new e.SystemRandomSource;function s(p,y=i.defaultRandomSource){return y.randomBytes(p)}i.randomBytes=s;function o(p=i.defaultRandomSource){const y=s(4,p),x=(0,t.readUint32LE)(y);return(0,r.wipe)(y),x}i.randomUint32=o;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(p,y=u,x=i.defaultRandomSource){if(y.length<2)throw new Error("randomString charset is too short");if(y.length>256)throw new Error("randomString charset is too long");let P="";const E=y.length,D=256-256%E;for(;p>0;){const F=s(Math.ceil(p*256/D),x);for(let N=0;N<F.length&&p>0;N++){const M=F[N];M<D&&(P+=y.charAt(M%E),p--)}(0,r.wipe)(F)}return P}i.randomString=c;function h(p,y=u,x=i.defaultRandomSource){const P=Math.ceil(p/(Math.log(y.length)/Math.LN2));return c(P,y,x)}i.randomStringForEntropy=h})(ii);var $n={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=ie,t=ut;i.DIGEST_LENGTH=64,i.BLOCK_SIZE=128;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,p){if(p===void 0&&(p=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var y=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<i.BLOCK_SIZE&&p>0;)this._buffer[this._bufferLength++]=h[y++],p--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(y=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,y,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=h[y++],p--;return this},c.prototype.finish=function(h){if(!this._finished){var p=this._bytesHashed,y=this._bufferLength,x=p/536870912|0,P=p<<3,E=p%128<112?128:256;this._buffer[y]=128;for(var D=y+1;D<E-8;D++)this._buffer[D]=0;e.writeUint32BE(x,this._buffer,E-8),e.writeUint32BE(P,this._buffer,E-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,E),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)e.writeUint32BE(this._stateHi[D],h,D*8),e.writeUint32BE(this._stateLo[D],h,D*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.stateHi),t.wipe(h.stateLo),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();i.SHA512=r;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,h,p,y,x,P,E){for(var D=p[0],F=p[1],N=p[2],M=p[3],_=p[4],S=p[5],d=p[6],w=p[7],b=y[0],n=y[1],f=y[2],U=y[3],z=y[4],Y=y[5],J=y[6],X=y[7],C,A,k,j,R,L,$,H;E>=128;){for(var re=0;re<16;re++){var B=8*re+P;c[re]=e.readUint32BE(x,B),h[re]=e.readUint32BE(x,B+4)}for(var re=0;re<80;re++){var Q=D,W=F,oe=N,O=M,I=_,m=S,a=d,g=w,K=b,V=n,le=f,be=U,de=z,me=Y,Re=J,Ce=X;if(C=w,A=X,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=(_>>>14|z<<32-14)^(_>>>18|z<<32-18)^(z>>>41-32|_<<32-(41-32)),A=(z>>>14|_<<32-14)^(z>>>18|_<<32-18)^(_>>>41-32|z<<32-(41-32)),R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,C=_&S^~_&d,A=z&Y^~z&J,R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,C=s[re*2],A=s[re*2+1],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,C=c[re%16],A=h[re%16],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,k=$&65535|H<<16,j=R&65535|L<<16,C=k,A=j,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=(D>>>28|b<<32-28)^(b>>>34-32|D<<32-(34-32))^(b>>>39-32|D<<32-(39-32)),A=(b>>>28|D<<32-28)^(D>>>34-32|b<<32-(34-32))^(D>>>39-32|b<<32-(39-32)),R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,C=D&F^D&N^F&N,A=b&n^b&f^n&f,R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,g=$&65535|H<<16,Ce=R&65535|L<<16,C=O,A=be,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=k,A=j,R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,O=$&65535|H<<16,be=R&65535|L<<16,F=Q,N=W,M=oe,_=O,S=I,d=m,w=a,D=g,n=K,f=V,U=le,z=be,Y=de,J=me,X=Re,b=Ce,re%16===15)for(var B=0;B<16;B++)C=c[B],A=h[B],R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=c[(B+9)%16],A=h[(B+9)%16],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,k=c[(B+1)%16],j=h[(B+1)%16],C=(k>>>1|j<<32-1)^(k>>>8|j<<32-8)^k>>>7,A=(j>>>1|k<<32-1)^(j>>>8|k<<32-8)^(j>>>7|k<<32-7),R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,k=c[(B+14)%16],j=h[(B+14)%16],C=(k>>>19|j<<32-19)^(j>>>61-32|k<<32-(61-32))^k>>>6,A=(j>>>19|k<<32-19)^(k>>>61-32|j<<32-(61-32))^(j>>>6|k<<32-6),R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,c[B]=$&65535|H<<16,h[B]=R&65535|L<<16}C=D,A=b,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[0],A=y[0],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[0]=D=$&65535|H<<16,y[0]=b=R&65535|L<<16,C=F,A=n,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[1],A=y[1],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[1]=F=$&65535|H<<16,y[1]=n=R&65535|L<<16,C=N,A=f,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[2],A=y[2],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[2]=N=$&65535|H<<16,y[2]=f=R&65535|L<<16,C=M,A=U,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[3],A=y[3],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[3]=M=$&65535|H<<16,y[3]=U=R&65535|L<<16,C=_,A=z,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[4],A=y[4],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[4]=_=$&65535|H<<16,y[4]=z=R&65535|L<<16,C=S,A=Y,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[5],A=y[5],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[5]=S=$&65535|H<<16,y[5]=Y=R&65535|L<<16,C=d,A=J,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[6],A=y[6],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[6]=d=$&65535|H<<16,y[6]=J=R&65535|L<<16,C=w,A=X,R=A&65535,L=A>>>16,$=C&65535,H=C>>>16,C=p[7],A=y[7],R+=A&65535,L+=A>>>16,$+=C&65535,H+=C>>>16,L+=R>>>16,$+=L>>>16,H+=$>>>16,p[7]=w=$&65535|H<<16,y[7]=X=R&65535|L<<16,P+=128,E-=128}return P}function u(c){var h=new r;h.update(c);var p=h.digest();return h.clean(),p}i.hash=u})($n);(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertSecretKeyToX25519=i.convertPublicKeyToX25519=i.verify=i.sign=i.extractPublicKeyFromSecretKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.SEED_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=i.SIGNATURE_LENGTH=void 0;const e=ii,t=$n,r=ut;i.SIGNATURE_LENGTH=64,i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=64,i.SEED_LENGTH=32;function s(O){const I=new Float64Array(16);if(O)for(let m=0;m<O.length;m++)I[m]=O[m];return I}const o=new Uint8Array(32);o[0]=9;const u=s(),c=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),p=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),y=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),x=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),P=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function E(O,I){for(let m=0;m<16;m++)O[m]=I[m]|0}function D(O){let I=1;for(let m=0;m<16;m++){let a=O[m]+I+65535;I=Math.floor(a/65536),O[m]=a-I*65536}O[0]+=I-1+37*(I-1)}function F(O,I,m){const a=~(m-1);for(let g=0;g<16;g++){const K=a&(O[g]^I[g]);O[g]^=K,I[g]^=K}}function N(O,I){const m=s(),a=s();for(let g=0;g<16;g++)a[g]=I[g];D(a),D(a),D(a);for(let g=0;g<2;g++){m[0]=a[0]-65517;for(let V=1;V<15;V++)m[V]=a[V]-65535-(m[V-1]>>16&1),m[V-1]&=65535;m[15]=a[15]-32767-(m[14]>>16&1);const K=m[15]>>16&1;m[14]&=65535,F(a,m,1-K)}for(let g=0;g<16;g++)O[2*g]=a[g]&255,O[2*g+1]=a[g]>>8}function M(O,I){let m=0;for(let a=0;a<32;a++)m|=O[a]^I[a];return(1&m-1>>>8)-1}function _(O,I){const m=new Uint8Array(32),a=new Uint8Array(32);return N(m,O),N(a,I),M(m,a)}function S(O){const I=new Uint8Array(32);return N(I,O),I[0]&1}function d(O,I){for(let m=0;m<16;m++)O[m]=I[2*m]+(I[2*m+1]<<8);O[15]&=32767}function w(O,I,m){for(let a=0;a<16;a++)O[a]=I[a]+m[a]}function b(O,I,m){for(let a=0;a<16;a++)O[a]=I[a]-m[a]}function n(O,I,m){let a,g,K=0,V=0,le=0,be=0,de=0,me=0,Re=0,Ce=0,ye=0,pe=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,ge=0,te=0,we=0,_e=0,De=0,Se=0,ve=0,gt=0,wt=0,Ct=0,ct=0,jt=0,ri=0,Di=0,Ue=m[0],Pe=m[1],Le=m[2],Me=m[3],$e=m[4],Ne=m[5],Be=m[6],Ke=m[7],qe=m[8],Ve=m[9],Ge=m[10],ze=m[11],je=m[12],Oe=m[13],ke=m[14],We=m[15];a=I[0],K+=a*Ue,V+=a*Pe,le+=a*Le,be+=a*Me,de+=a*$e,me+=a*Ne,Re+=a*Be,Ce+=a*Ke,ye+=a*qe,pe+=a*Ve,fe+=a*Ge,he+=a*ze,ce+=a*je,ae+=a*Oe,ne+=a*ke,ee+=a*We,a=I[1],V+=a*Ue,le+=a*Pe,be+=a*Le,de+=a*Me,me+=a*$e,Re+=a*Ne,Ce+=a*Be,ye+=a*Ke,pe+=a*qe,fe+=a*Ve,he+=a*Ge,ce+=a*ze,ae+=a*je,ne+=a*Oe,ee+=a*ke,ue+=a*We,a=I[2],le+=a*Ue,be+=a*Pe,de+=a*Le,me+=a*Me,Re+=a*$e,Ce+=a*Ne,ye+=a*Be,pe+=a*Ke,fe+=a*qe,he+=a*Ve,ce+=a*Ge,ae+=a*ze,ne+=a*je,ee+=a*Oe,ue+=a*ke,ge+=a*We,a=I[3],be+=a*Ue,de+=a*Pe,me+=a*Le,Re+=a*Me,Ce+=a*$e,ye+=a*Ne,pe+=a*Be,fe+=a*Ke,he+=a*qe,ce+=a*Ve,ae+=a*Ge,ne+=a*ze,ee+=a*je,ue+=a*Oe,ge+=a*ke,te+=a*We,a=I[4],de+=a*Ue,me+=a*Pe,Re+=a*Le,Ce+=a*Me,ye+=a*$e,pe+=a*Ne,fe+=a*Be,he+=a*Ke,ce+=a*qe,ae+=a*Ve,ne+=a*Ge,ee+=a*ze,ue+=a*je,ge+=a*Oe,te+=a*ke,we+=a*We,a=I[5],me+=a*Ue,Re+=a*Pe,Ce+=a*Le,ye+=a*Me,pe+=a*$e,fe+=a*Ne,he+=a*Be,ce+=a*Ke,ae+=a*qe,ne+=a*Ve,ee+=a*Ge,ue+=a*ze,ge+=a*je,te+=a*Oe,we+=a*ke,_e+=a*We,a=I[6],Re+=a*Ue,Ce+=a*Pe,ye+=a*Le,pe+=a*Me,fe+=a*$e,he+=a*Ne,ce+=a*Be,ae+=a*Ke,ne+=a*qe,ee+=a*Ve,ue+=a*Ge,ge+=a*ze,te+=a*je,we+=a*Oe,_e+=a*ke,De+=a*We,a=I[7],Ce+=a*Ue,ye+=a*Pe,pe+=a*Le,fe+=a*Me,he+=a*$e,ce+=a*Ne,ae+=a*Be,ne+=a*Ke,ee+=a*qe,ue+=a*Ve,ge+=a*Ge,te+=a*ze,we+=a*je,_e+=a*Oe,De+=a*ke,Se+=a*We,a=I[8],ye+=a*Ue,pe+=a*Pe,fe+=a*Le,he+=a*Me,ce+=a*$e,ae+=a*Ne,ne+=a*Be,ee+=a*Ke,ue+=a*qe,ge+=a*Ve,te+=a*Ge,we+=a*ze,_e+=a*je,De+=a*Oe,Se+=a*ke,ve+=a*We,a=I[9],pe+=a*Ue,fe+=a*Pe,he+=a*Le,ce+=a*Me,ae+=a*$e,ne+=a*Ne,ee+=a*Be,ue+=a*Ke,ge+=a*qe,te+=a*Ve,we+=a*Ge,_e+=a*ze,De+=a*je,Se+=a*Oe,ve+=a*ke,gt+=a*We,a=I[10],fe+=a*Ue,he+=a*Pe,ce+=a*Le,ae+=a*Me,ne+=a*$e,ee+=a*Ne,ue+=a*Be,ge+=a*Ke,te+=a*qe,we+=a*Ve,_e+=a*Ge,De+=a*ze,Se+=a*je,ve+=a*Oe,gt+=a*ke,wt+=a*We,a=I[11],he+=a*Ue,ce+=a*Pe,ae+=a*Le,ne+=a*Me,ee+=a*$e,ue+=a*Ne,ge+=a*Be,te+=a*Ke,we+=a*qe,_e+=a*Ve,De+=a*Ge,Se+=a*ze,ve+=a*je,gt+=a*Oe,wt+=a*ke,Ct+=a*We,a=I[12],ce+=a*Ue,ae+=a*Pe,ne+=a*Le,ee+=a*Me,ue+=a*$e,ge+=a*Ne,te+=a*Be,we+=a*Ke,_e+=a*qe,De+=a*Ve,Se+=a*Ge,ve+=a*ze,gt+=a*je,wt+=a*Oe,Ct+=a*ke,ct+=a*We,a=I[13],ae+=a*Ue,ne+=a*Pe,ee+=a*Le,ue+=a*Me,ge+=a*$e,te+=a*Ne,we+=a*Be,_e+=a*Ke,De+=a*qe,Se+=a*Ve,ve+=a*Ge,gt+=a*ze,wt+=a*je,Ct+=a*Oe,ct+=a*ke,jt+=a*We,a=I[14],ne+=a*Ue,ee+=a*Pe,ue+=a*Le,ge+=a*Me,te+=a*$e,we+=a*Ne,_e+=a*Be,De+=a*Ke,Se+=a*qe,ve+=a*Ve,gt+=a*Ge,wt+=a*ze,Ct+=a*je,ct+=a*Oe,jt+=a*ke,ri+=a*We,a=I[15],ee+=a*Ue,ue+=a*Pe,ge+=a*Le,te+=a*Me,we+=a*$e,_e+=a*Ne,De+=a*Be,Se+=a*Ke,ve+=a*qe,gt+=a*Ve,wt+=a*Ge,Ct+=a*ze,ct+=a*je,jt+=a*Oe,ri+=a*ke,Di+=a*We,K+=38*ue,V+=38*ge,le+=38*te,be+=38*we,de+=38*_e,me+=38*De,Re+=38*Se,Ce+=38*ve,ye+=38*gt,pe+=38*wt,fe+=38*Ct,he+=38*ct,ce+=38*jt,ae+=38*ri,ne+=38*Di,g=1,a=K+g+65535,g=Math.floor(a/65536),K=a-g*65536,a=V+g+65535,g=Math.floor(a/65536),V=a-g*65536,a=le+g+65535,g=Math.floor(a/65536),le=a-g*65536,a=be+g+65535,g=Math.floor(a/65536),be=a-g*65536,a=de+g+65535,g=Math.floor(a/65536),de=a-g*65536,a=me+g+65535,g=Math.floor(a/65536),me=a-g*65536,a=Re+g+65535,g=Math.floor(a/65536),Re=a-g*65536,a=Ce+g+65535,g=Math.floor(a/65536),Ce=a-g*65536,a=ye+g+65535,g=Math.floor(a/65536),ye=a-g*65536,a=pe+g+65535,g=Math.floor(a/65536),pe=a-g*65536,a=fe+g+65535,g=Math.floor(a/65536),fe=a-g*65536,a=he+g+65535,g=Math.floor(a/65536),he=a-g*65536,a=ce+g+65535,g=Math.floor(a/65536),ce=a-g*65536,a=ae+g+65535,g=Math.floor(a/65536),ae=a-g*65536,a=ne+g+65535,g=Math.floor(a/65536),ne=a-g*65536,a=ee+g+65535,g=Math.floor(a/65536),ee=a-g*65536,K+=g-1+37*(g-1),g=1,a=K+g+65535,g=Math.floor(a/65536),K=a-g*65536,a=V+g+65535,g=Math.floor(a/65536),V=a-g*65536,a=le+g+65535,g=Math.floor(a/65536),le=a-g*65536,a=be+g+65535,g=Math.floor(a/65536),be=a-g*65536,a=de+g+65535,g=Math.floor(a/65536),de=a-g*65536,a=me+g+65535,g=Math.floor(a/65536),me=a-g*65536,a=Re+g+65535,g=Math.floor(a/65536),Re=a-g*65536,a=Ce+g+65535,g=Math.floor(a/65536),Ce=a-g*65536,a=ye+g+65535,g=Math.floor(a/65536),ye=a-g*65536,a=pe+g+65535,g=Math.floor(a/65536),pe=a-g*65536,a=fe+g+65535,g=Math.floor(a/65536),fe=a-g*65536,a=he+g+65535,g=Math.floor(a/65536),he=a-g*65536,a=ce+g+65535,g=Math.floor(a/65536),ce=a-g*65536,a=ae+g+65535,g=Math.floor(a/65536),ae=a-g*65536,a=ne+g+65535,g=Math.floor(a/65536),ne=a-g*65536,a=ee+g+65535,g=Math.floor(a/65536),ee=a-g*65536,K+=g-1+37*(g-1),O[0]=K,O[1]=V,O[2]=le,O[3]=be,O[4]=de,O[5]=me,O[6]=Re,O[7]=Ce,O[8]=ye,O[9]=pe,O[10]=fe,O[11]=he,O[12]=ce,O[13]=ae,O[14]=ne,O[15]=ee}function f(O,I){n(O,I,I)}function U(O,I){const m=s();let a;for(a=0;a<16;a++)m[a]=I[a];for(a=253;a>=0;a--)f(m,m),a!==2&&a!==4&&n(m,m,I);for(a=0;a<16;a++)O[a]=m[a]}function z(O,I){const m=s();let a;for(a=0;a<16;a++)m[a]=I[a];for(a=250;a>=0;a--)f(m,m),a!==1&&n(m,m,I);for(a=0;a<16;a++)O[a]=m[a]}function Y(O,I){const m=s(),a=s(),g=s(),K=s(),V=s(),le=s(),be=s(),de=s(),me=s();b(m,O[1],O[0]),b(me,I[1],I[0]),n(m,m,me),w(a,O[0],O[1]),w(me,I[0],I[1]),n(a,a,me),n(g,O[3],I[3]),n(g,g,p),n(K,O[2],I[2]),w(K,K,K),b(V,a,m),b(le,K,g),w(be,K,g),w(de,a,m),n(O[0],V,le),n(O[1],de,be),n(O[2],be,le),n(O[3],V,de)}function J(O,I,m){for(let a=0;a<4;a++)F(O[a],I[a],m)}function X(O,I){const m=s(),a=s(),g=s();U(g,I[2]),n(m,I[0],g),n(a,I[1],g),N(O,a),O[31]^=S(m)<<7}function C(O,I,m){E(O[0],u),E(O[1],c),E(O[2],c),E(O[3],u);for(let a=255;a>=0;--a){const g=m[a/8|0]>>(a&7)&1;J(O,I,g),Y(I,O),Y(O,O),J(O,I,g)}}function A(O,I){const m=[s(),s(),s(),s()];E(m[0],y),E(m[1],x),E(m[2],c),n(m[3],y,x),C(O,m,I)}function k(O){if(O.length!==i.SEED_LENGTH)throw new Error(`ed25519: seed must be ${i.SEED_LENGTH} bytes`);const I=(0,t.hash)(O);I[0]&=248,I[31]&=127,I[31]|=64;const m=new Uint8Array(32),a=[s(),s(),s(),s()];A(a,I),X(m,a);const g=new Uint8Array(64);return g.set(O),g.set(m,32),{publicKey:m,secretKey:g}}i.generateKeyPairFromSeed=k;function j(O){const I=(0,e.randomBytes)(32,O),m=k(I);return(0,r.wipe)(I),m}i.generateKeyPair=j;function R(O){if(O.length!==i.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${i.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}i.extractPublicKeyFromSecretKey=R;const L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(O,I){let m,a,g,K;for(a=63;a>=32;--a){for(m=0,g=a-32,K=a-12;g<K;++g)I[g]+=m-16*I[a]*L[g-(a-32)],m=Math.floor((I[g]+128)/256),I[g]-=m*256;I[g]+=m,I[a]=0}for(m=0,g=0;g<32;g++)I[g]+=m-(I[31]>>4)*L[g],m=I[g]>>8,I[g]&=255;for(g=0;g<32;g++)I[g]-=m*L[g];for(a=0;a<32;a++)I[a+1]+=I[a]>>8,O[a]=I[a]&255}function H(O){const I=new Float64Array(64);for(let m=0;m<64;m++)I[m]=O[m];for(let m=0;m<64;m++)O[m]=0;$(O,I)}function re(O,I){const m=new Float64Array(64),a=[s(),s(),s(),s()],g=(0,t.hash)(O.subarray(0,32));g[0]&=248,g[31]&=127,g[31]|=64;const K=new Uint8Array(64);K.set(g.subarray(32),32);const V=new t.SHA512;V.update(K.subarray(32)),V.update(I);const le=V.digest();V.clean(),H(le),A(a,le),X(K,a),V.reset(),V.update(K.subarray(0,32)),V.update(O.subarray(32)),V.update(I);const be=V.digest();H(be);for(let de=0;de<32;de++)m[de]=le[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)m[de+me]+=be[de]*g[me];return $(K.subarray(32),m),K}i.sign=re;function B(O,I){const m=s(),a=s(),g=s(),K=s(),V=s(),le=s(),be=s();return E(O[2],c),d(O[1],I),f(g,O[1]),n(K,g,h),b(g,g,O[2]),w(K,O[2],K),f(V,K),f(le,V),n(be,le,V),n(m,be,g),n(m,m,K),z(m,m),n(m,m,g),n(m,m,K),n(m,m,K),n(O[0],m,K),f(a,O[0]),n(a,a,K),_(a,g)&&n(O[0],O[0],P),f(a,O[0]),n(a,a,K),_(a,g)?-1:(S(O[0])===I[31]>>7&&b(O[0],u,O[0]),n(O[3],O[0],O[1]),0)}function Q(O,I,m){const a=new Uint8Array(32),g=[s(),s(),s(),s()],K=[s(),s(),s(),s()];if(m.length!==i.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${i.SIGNATURE_LENGTH} bytes`);if(B(K,O))return!1;const V=new t.SHA512;V.update(m.subarray(0,32)),V.update(O),V.update(I);const le=V.digest();return H(le),C(g,K,le),A(K,m.subarray(32)),Y(g,K),X(a,g),!M(m,a)}i.verify=Q;function W(O){let I=[s(),s(),s(),s()];if(B(I,O))throw new Error("Ed25519: invalid public key");let m=s(),a=s(),g=I[1];w(m,c,g),b(a,c,g),U(a,a),n(m,m,a);let K=new Uint8Array(32);return N(K,m),K}i.convertPublicKeyToX25519=W;function oe(O){const I=(0,t.hash)(O.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const m=new Uint8Array(I.subarray(0,32));return(0,r.wipe)(I),m}i.convertSecretKeyToX25519=oe})(Hr);const Qc="EdDSA",eh="JWT",jn=".",zn="base64url",th="utf8",ih="utf8",rh=":",sh="did",nh="key",ws="base58btc",ah="z",oh="K36",ch=32;function Hn(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function wr(i,e){e||(e=i.reduce((s,o)=>s+o.length,0));const t=Hn(e);let r=0;for(const s of i)t.set(s,r),r+=s.length;return t}function hh(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),u=o.charCodeAt(0);if(t[u]!==255)throw new TypeError(o+" is ambiguous");t[u]=s}var c=i.length,h=i.charAt(0),p=Math.log(c)/Math.log(256),y=Math.log(256)/Math.log(c);function x(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var F=0,N=0,M=0,_=D.length;M!==_&&D[M]===0;)M++,F++;for(var S=(_-M)*y+1>>>0,d=new Uint8Array(S);M!==_;){for(var w=D[M],b=0,n=S-1;(w!==0||b<N)&&n!==-1;n--,b++)w+=256*d[n]>>>0,d[n]=w%c>>>0,w=w/c>>>0;if(w!==0)throw new Error("Non-zero carry");N=b,M++}for(var f=S-N;f!==S&&d[f]===0;)f++;for(var U=h.repeat(F);f<S;++f)U+=i.charAt(d[f]);return U}function P(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var F=0;if(D[F]!==" "){for(var N=0,M=0;D[F]===h;)N++,F++;for(var _=(D.length-F)*p+1>>>0,S=new Uint8Array(_);D[F];){var d=t[D.charCodeAt(F)];if(d===255)return;for(var w=0,b=_-1;(d!==0||w<M)&&b!==-1;b--,w++)d+=c*S[b]>>>0,S[b]=d%256>>>0,d=d/256>>>0;if(d!==0)throw new Error("Non-zero carry");M=w,F++}if(D[F]!==" "){for(var n=_-M;n!==_&&S[n]===0;)n++;for(var f=new Uint8Array(N+(_-n)),U=N;n!==_;)f[U++]=S[n++];return f}}}function E(D){var F=P(D);if(F)return F;throw new Error(`Non-${e} character`)}return{encode:x,decodeUnsafe:P,decode:E}}var uh=hh,lh=uh;const Bn=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},fh=i=>new TextEncoder().encode(i),dh=i=>new TextDecoder().decode(i);class ph{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class gh{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Kn(this,e)}}class yh{constructor(e){this.decoders=e}or(e){return Kn(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Kn=(i,e)=>new yh(Ee(Ee({},i.decoders||{[i.prefix]:i}),e.decoders||{[e.prefix]:e}));class bh{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new ph(e,t,r),this.decoder=new gh(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zi=({name:i,prefix:e,encode:t,decode:r})=>new bh(i,e,t,r),bi=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=lh(t,e);return Zi({prefix:i,name:e,encode:r,decode:o=>Bn(s(o))})},wh=(i,e,t,r)=>{const s={};for(let y=0;y<e.length;++y)s[e[y]]=y;let o=i.length;for(;i[o-1]==="=";)--o;const u=new Uint8Array(o*t/8|0);let c=0,h=0,p=0;for(let y=0;y<o;++y){const x=s[i[y]];if(x===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|x,c+=t,c>=8&&(c-=8,u[p++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},_h=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",u=0,c=0;for(let h=0;h<i.length;++h)for(c=c<<8|i[h],u+=8;u>t;)u-=t,o+=e[s&c>>u];if(u&&(o+=e[s&c<<t-u]),r)for(;o.length*t&7;)o+="=";return o},Ze=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>Zi({prefix:e,name:i,encode(s){return _h(s,r,t)},decode(s){return wh(s,r,t,i)}}),mh=Zi({prefix:"\0",name:"identity",encode:i=>dh(i),decode:i=>fh(i)});var vh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",identity:mh});const Eh=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Dh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base2:Eh});const Sh=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var xh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base8:Sh});const Ih=bi({prefix:"9",name:"base10",alphabet:"0123456789"});var Oh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base10:Ih});const Ah=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ch=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ph=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base16:Ah,base16upper:Ch});const Nh=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Th=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Rh=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fh=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Uh=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Lh=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Mh=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$h=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),jh=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var zh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base32:Nh,base32upper:Th,base32pad:Rh,base32padupper:Fh,base32hex:Uh,base32hexupper:Lh,base32hexpad:Mh,base32hexpadupper:$h,base32z:jh});const Hh=bi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bh=bi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Kh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base36:Hh,base36upper:Bh});const qh=bi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Vh=bi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Gh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base58btc:qh,base58flickr:Vh});const kh=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wh=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Yh=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Jh=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Xh=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base64:kh,base64pad:Wh,base64url:Yh,base64urlpad:Jh});const qn=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Zh=qn.reduce((i,e,t)=>(i[t]=e,i),[]),Qh=qn.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function eu(i){return i.reduce((e,t)=>(e+=Zh[t],e),"")}function tu(i){const e=[];for(const t of i){const r=Qh[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const iu=Zi({prefix:"\u{1F680}",name:"base256emoji",encode:eu,decode:tu});var ru=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",base256emoji:iu}),su=Vn,_s=128,nu=127,au=~nu,ou=Math.pow(2,31);function Vn(i,e,t){e=e||[],t=t||0;for(var r=t;i>=ou;)e[t++]=i&255|_s,i/=128;for(;i&au;)e[t++]=i&255|_s,i>>>=7;return e[t]=i|0,Vn.bytes=t-r+1,e}var cu=_r,hu=128,ms=127;function _r(i,r){var t=0,r=r||0,s=0,o=r,u,c=i.length;do{if(o>=c)throw _r.bytes=0,new RangeError("Could not decode varint");u=i[o++],t+=s<28?(u&ms)<<s:(u&ms)*Math.pow(2,s),s+=7}while(u>=hu);return _r.bytes=o-r,t}var uu=Math.pow(2,7),lu=Math.pow(2,14),fu=Math.pow(2,21),du=Math.pow(2,28),pu=Math.pow(2,35),gu=Math.pow(2,42),yu=Math.pow(2,49),bu=Math.pow(2,56),wu=Math.pow(2,63),_u=function(i){return i<uu?1:i<lu?2:i<fu?3:i<du?4:i<pu?5:i<gu?6:i<yu?7:i<bu?8:i<wu?9:10},mu={encode:su,decode:cu,encodingLength:_u},Gn=mu;const vs=(i,e,t=0)=>(Gn.encode(i,e,t),e),Es=i=>Gn.encodingLength(i),mr=(i,e)=>{const t=e.byteLength,r=Es(i),s=r+Es(t),o=new Uint8Array(s+t);return vs(i,o,0),vs(t,o,r),o.set(e,s),new vu(i,t,e,o)};class vu{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const kn=({name:i,code:e,encode:t})=>new Eu(i,e,t);class Eu{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?mr(this.code,t):t.then(r=>mr(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Wn=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Du=kn({name:"sha2-256",code:18,encode:Wn("SHA-256")}),Su=kn({name:"sha2-512",code:19,encode:Wn("SHA-512")});var xu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",sha256:Du,sha512:Su});const Yn=0,Iu="identity",Jn=Bn,Ou=i=>mr(Yn,Jn(i)),Au={code:Yn,name:Iu,encode:Jn,digest:Ou};var Cu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",identity:Au});new TextEncoder;new TextDecoder;const Ds=Ee(Ee(Ee(Ee(Ee(Ee(Ee(Ee(Ee(Ee({},vh),Dh),xh),Oh),Ph),zh),Kh),Gh),Xh),ru);Ee(Ee({},xu),Cu);function Xn(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const Ss=Xn("utf8","u",i=>{const e=new TextDecoder("utf8");return"u"+e.decode(i)},i=>new TextEncoder().encode(i.substring(1))),or=Xn("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Hn(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Zn=Ee({utf8:Ss,"utf-8":Ss,hex:Ds.base16,latin1:or,ascii:or,binary:or},Ds);function ot(i,e="utf8"){const t=Zn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}function nt(i,e="utf8"){const t=Zn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}function $i(i){return ot(nt(Tr(i),th),zn)}function Qn(i){const e=nt(oh,ws),t=ah+ot(wr([e,i]),ws);return[sh,nh,t].join(rh)}function Pu(i){return ot(i,zn)}function Nu(i){return nt([$i(i.header),$i(i.payload)].join(jn),ih)}function Tu(i){return[$i(i.header),$i(i.payload),Pu(i.signature)].join(jn)}function xs(i=ii.randomBytes(ch)){return Hr.generateKeyPairFromSeed(i)}async function Ru(i,e,t,r,s=Z.fromMiliseconds(Date.now())){const o={alg:Qc,typ:eh},u=Qn(r.publicKey),c=s+t,h={iss:u,sub:i,aud:e,iat:s,exp:c},p=Nu({header:o,payload:h}),y=Hr.sign(r.secretKey,p);return Tu({header:o,payload:h,signature:y})}var Br={},Qi={};Object.defineProperty(Qi,"__esModule",{value:!0});var tt=ie,vr=ut,Fu=20;function Uu(i,e,t){for(var r=1634760805,s=857760878,o=2036477234,u=1797285236,c=t[3]<<24|t[2]<<16|t[1]<<8|t[0],h=t[7]<<24|t[6]<<16|t[5]<<8|t[4],p=t[11]<<24|t[10]<<16|t[9]<<8|t[8],y=t[15]<<24|t[14]<<16|t[13]<<8|t[12],x=t[19]<<24|t[18]<<16|t[17]<<8|t[16],P=t[23]<<24|t[22]<<16|t[21]<<8|t[20],E=t[27]<<24|t[26]<<16|t[25]<<8|t[24],D=t[31]<<24|t[30]<<16|t[29]<<8|t[28],F=e[3]<<24|e[2]<<16|e[1]<<8|e[0],N=e[7]<<24|e[6]<<16|e[5]<<8|e[4],M=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],S=r,d=s,w=o,b=u,n=c,f=h,U=p,z=y,Y=x,J=P,X=E,C=D,A=F,k=N,j=M,R=_,L=0;L<Fu;L+=2)S=S+n|0,A^=S,A=A>>>32-16|A<<16,Y=Y+A|0,n^=Y,n=n>>>32-12|n<<12,d=d+f|0,k^=d,k=k>>>32-16|k<<16,J=J+k|0,f^=J,f=f>>>32-12|f<<12,w=w+U|0,j^=w,j=j>>>32-16|j<<16,X=X+j|0,U^=X,U=U>>>32-12|U<<12,b=b+z|0,R^=b,R=R>>>32-16|R<<16,C=C+R|0,z^=C,z=z>>>32-12|z<<12,w=w+U|0,j^=w,j=j>>>32-8|j<<8,X=X+j|0,U^=X,U=U>>>32-7|U<<7,b=b+z|0,R^=b,R=R>>>32-8|R<<8,C=C+R|0,z^=C,z=z>>>32-7|z<<7,d=d+f|0,k^=d,k=k>>>32-8|k<<8,J=J+k|0,f^=J,f=f>>>32-7|f<<7,S=S+n|0,A^=S,A=A>>>32-8|A<<8,Y=Y+A|0,n^=Y,n=n>>>32-7|n<<7,S=S+f|0,R^=S,R=R>>>32-16|R<<16,X=X+R|0,f^=X,f=f>>>32-12|f<<12,d=d+U|0,A^=d,A=A>>>32-16|A<<16,C=C+A|0,U^=C,U=U>>>32-12|U<<12,w=w+z|0,k^=w,k=k>>>32-16|k<<16,Y=Y+k|0,z^=Y,z=z>>>32-12|z<<12,b=b+n|0,j^=b,j=j>>>32-16|j<<16,J=J+j|0,n^=J,n=n>>>32-12|n<<12,w=w+z|0,k^=w,k=k>>>32-8|k<<8,Y=Y+k|0,z^=Y,z=z>>>32-7|z<<7,b=b+n|0,j^=b,j=j>>>32-8|j<<8,J=J+j|0,n^=J,n=n>>>32-7|n<<7,d=d+U|0,A^=d,A=A>>>32-8|A<<8,C=C+A|0,U^=C,U=U>>>32-7|U<<7,S=S+f|0,R^=S,R=R>>>32-8|R<<8,X=X+R|0,f^=X,f=f>>>32-7|f<<7;tt.writeUint32LE(S+r|0,i,0),tt.writeUint32LE(d+s|0,i,4),tt.writeUint32LE(w+o|0,i,8),tt.writeUint32LE(b+u|0,i,12),tt.writeUint32LE(n+c|0,i,16),tt.writeUint32LE(f+h|0,i,20),tt.writeUint32LE(U+p|0,i,24),tt.writeUint32LE(z+y|0,i,28),tt.writeUint32LE(Y+x|0,i,32),tt.writeUint32LE(J+P|0,i,36),tt.writeUint32LE(X+E|0,i,40),tt.writeUint32LE(C+D|0,i,44),tt.writeUint32LE(A+F|0,i,48),tt.writeUint32LE(k+N|0,i,52),tt.writeUint32LE(j+M|0,i,56),tt.writeUint32LE(R+_|0,i,60)}function ea(i,e,t,r,s){if(s===void 0&&(s=0),i.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(r.length<t.length)throw new Error("ChaCha: destination is shorter than source");var o,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),u=o.length-e.length,o.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,u=s}for(var c=new Uint8Array(64),h=0;h<t.length;h+=64){Uu(c,o,i);for(var p=h;p<h+64&&p<t.length;p++)r[p]=t[p]^c[p-h];Mu(o,0,u)}return vr.wipe(c),s===0&&vr.wipe(o),r}Qi.streamXOR=ea;function Lu(i,e,t,r){return r===void 0&&(r=0),vr.wipe(t),ea(i,e,t,t,r)}Qi.stream=Lu;function Mu(i,e,t){for(var r=1;t--;)r=r+(i[e]&255)|0,i[e]=r&255,r>>>=8,e++;if(r>0)throw new Error("ChaCha: counter overflow")}var ta={},$t={};Object.defineProperty($t,"__esModule",{value:!0});function $u(i,e,t){return~(i-1)&e|i-1&t}$t.select=$u;function ju(i,e){return(i|0)-(e|0)-1>>>31&1}$t.lessOrEqual=ju;function ia(i,e){if(i.length!==e.length)return 0;for(var t=0,r=0;r<i.length;r++)t|=i[r]^e[r];return 1&t-1>>>8}$t.compare=ia;function zu(i,e){return i.length===0||e.length===0?!1:ia(i,e)!==0}$t.equal=zu;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=$t,t=ut;i.DIGEST_LENGTH=16;var r=function(){function u(c){this.digestLength=i.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var p=c[2]|c[3]<<8;this._r[1]=(h>>>13|p<<3)&8191;var y=c[4]|c[5]<<8;this._r[2]=(p>>>10|y<<6)&7939;var x=c[6]|c[7]<<8;this._r[3]=(y>>>7|x<<9)&8191;var P=c[8]|c[9]<<8;this._r[4]=(x>>>4|P<<12)&255,this._r[5]=P>>>1&8190;var E=c[10]|c[11]<<8;this._r[6]=(P>>>14|E<<2)&8191;var D=c[12]|c[13]<<8;this._r[7]=(E>>>11|D<<5)&8065;var F=c[14]|c[15]<<8;this._r[8]=(D>>>8|F<<8)&8191,this._r[9]=F>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return u.prototype._blocks=function(c,h,p){for(var y=this._fin?0:2048,x=this._h[0],P=this._h[1],E=this._h[2],D=this._h[3],F=this._h[4],N=this._h[5],M=this._h[6],_=this._h[7],S=this._h[8],d=this._h[9],w=this._r[0],b=this._r[1],n=this._r[2],f=this._r[3],U=this._r[4],z=this._r[5],Y=this._r[6],J=this._r[7],X=this._r[8],C=this._r[9];p>=16;){var A=c[h+0]|c[h+1]<<8;x+=A&8191;var k=c[h+2]|c[h+3]<<8;P+=(A>>>13|k<<3)&8191;var j=c[h+4]|c[h+5]<<8;E+=(k>>>10|j<<6)&8191;var R=c[h+6]|c[h+7]<<8;D+=(j>>>7|R<<9)&8191;var L=c[h+8]|c[h+9]<<8;F+=(R>>>4|L<<12)&8191,N+=L>>>1&8191;var $=c[h+10]|c[h+11]<<8;M+=(L>>>14|$<<2)&8191;var H=c[h+12]|c[h+13]<<8;_+=($>>>11|H<<5)&8191;var re=c[h+14]|c[h+15]<<8;S+=(H>>>8|re<<8)&8191,d+=re>>>5|y;var B=0,Q=B;Q+=x*w,Q+=P*(5*C),Q+=E*(5*X),Q+=D*(5*J),Q+=F*(5*Y),B=Q>>>13,Q&=8191,Q+=N*(5*z),Q+=M*(5*U),Q+=_*(5*f),Q+=S*(5*n),Q+=d*(5*b),B+=Q>>>13,Q&=8191;var W=B;W+=x*b,W+=P*w,W+=E*(5*C),W+=D*(5*X),W+=F*(5*J),B=W>>>13,W&=8191,W+=N*(5*Y),W+=M*(5*z),W+=_*(5*U),W+=S*(5*f),W+=d*(5*n),B+=W>>>13,W&=8191;var oe=B;oe+=x*n,oe+=P*b,oe+=E*w,oe+=D*(5*C),oe+=F*(5*X),B=oe>>>13,oe&=8191,oe+=N*(5*J),oe+=M*(5*Y),oe+=_*(5*z),oe+=S*(5*U),oe+=d*(5*f),B+=oe>>>13,oe&=8191;var O=B;O+=x*f,O+=P*n,O+=E*b,O+=D*w,O+=F*(5*C),B=O>>>13,O&=8191,O+=N*(5*X),O+=M*(5*J),O+=_*(5*Y),O+=S*(5*z),O+=d*(5*U),B+=O>>>13,O&=8191;var I=B;I+=x*U,I+=P*f,I+=E*n,I+=D*b,I+=F*w,B=I>>>13,I&=8191,I+=N*(5*C),I+=M*(5*X),I+=_*(5*J),I+=S*(5*Y),I+=d*(5*z),B+=I>>>13,I&=8191;var m=B;m+=x*z,m+=P*U,m+=E*f,m+=D*n,m+=F*b,B=m>>>13,m&=8191,m+=N*w,m+=M*(5*C),m+=_*(5*X),m+=S*(5*J),m+=d*(5*Y),B+=m>>>13,m&=8191;var a=B;a+=x*Y,a+=P*z,a+=E*U,a+=D*f,a+=F*n,B=a>>>13,a&=8191,a+=N*b,a+=M*w,a+=_*(5*C),a+=S*(5*X),a+=d*(5*J),B+=a>>>13,a&=8191;var g=B;g+=x*J,g+=P*Y,g+=E*z,g+=D*U,g+=F*f,B=g>>>13,g&=8191,g+=N*n,g+=M*b,g+=_*w,g+=S*(5*C),g+=d*(5*X),B+=g>>>13,g&=8191;var K=B;K+=x*X,K+=P*J,K+=E*Y,K+=D*z,K+=F*U,B=K>>>13,K&=8191,K+=N*f,K+=M*n,K+=_*b,K+=S*w,K+=d*(5*C),B+=K>>>13,K&=8191;var V=B;V+=x*C,V+=P*X,V+=E*J,V+=D*Y,V+=F*z,B=V>>>13,V&=8191,V+=N*U,V+=M*f,V+=_*n,V+=S*b,V+=d*w,B+=V>>>13,V&=8191,B=(B<<2)+B|0,B=B+Q|0,Q=B&8191,B=B>>>13,W+=B,x=Q,P=W,E=oe,D=O,F=I,N=m,M=a,_=g,S=K,d=V,h+=16,p-=16}this._h[0]=x,this._h[1]=P,this._h[2]=E,this._h[3]=D,this._h[4]=F,this._h[5]=N,this._h[6]=M,this._h[7]=_,this._h[8]=S,this._h[9]=d},u.prototype.finish=function(c,h){h===void 0&&(h=0);var p=new Uint16Array(10),y,x,P,E;if(this._leftover){for(E=this._leftover,this._buffer[E++]=1;E<16;E++)this._buffer[E]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(y=this._h[1]>>>13,this._h[1]&=8191,E=2;E<10;E++)this._h[E]+=y,y=this._h[E]>>>13,this._h[E]&=8191;for(this._h[0]+=y*5,y=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=y,y=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=y,p[0]=this._h[0]+5,y=p[0]>>>13,p[0]&=8191,E=1;E<10;E++)p[E]=this._h[E]+y,y=p[E]>>>13,p[E]&=8191;for(p[9]-=1<<13,x=(y^1)-1,E=0;E<10;E++)p[E]&=x;for(x=~x,E=0;E<10;E++)this._h[E]=this._h[E]&x|p[E];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,P=this._h[0]+this._pad[0],this._h[0]=P&65535,E=1;E<8;E++)P=(this._h[E]+this._pad[E]|0)+(P>>>16)|0,this._h[E]=P&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(c){var h=0,p=c.length,y;if(this._leftover){y=16-this._leftover,y>p&&(y=p);for(var x=0;x<y;x++)this._buffer[this._leftover+x]=c[h+x];if(p-=y,h+=y,this._leftover+=y,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(p>=16&&(y=p-p%16,this._blocks(c,h,y),h+=y,p-=y),p){for(var x=0;x<p;x++)this._buffer[this._leftover+x]=c[h+x];this._leftover+=p}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},u.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();i.Poly1305=r;function s(u,c){var h=new r(u);h.update(c);var p=h.digest();return h.clean(),p}i.oneTimeAuth=s;function o(u,c){return u.length!==i.DIGEST_LENGTH||c.length!==i.DIGEST_LENGTH?!1:e.equal(u,c)}i.equal=o})(ta);(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Qi,t=ta,r=ut,s=ie,o=$t;i.KEY_LENGTH=32,i.NONCE_LENGTH=12,i.TAG_LENGTH=16;var u=new Uint8Array(16),c=function(){function h(p){if(this.nonceLength=i.NONCE_LENGTH,this.tagLength=i.TAG_LENGTH,p.length!==i.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(p)}return h.prototype.seal=function(p,y,x,P){if(p.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var E=new Uint8Array(16);E.set(p,E.length-p.length);var D=new Uint8Array(32);e.stream(this._key,E,D,4);var F=y.length+this.tagLength,N;if(P){if(P.length!==F)throw new Error("ChaCha20Poly1305: incorrect destination length");N=P}else N=new Uint8Array(F);return e.streamXOR(this._key,E,y,N,4),this._authenticate(N.subarray(N.length-this.tagLength,N.length),D,N.subarray(0,N.length-this.tagLength),x),r.wipe(E),N},h.prototype.open=function(p,y,x,P){if(p.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(y.length<this.tagLength)return null;var E=new Uint8Array(16);E.set(p,E.length-p.length);var D=new Uint8Array(32);e.stream(this._key,E,D,4);var F=new Uint8Array(this.tagLength);if(this._authenticate(F,D,y.subarray(0,y.length-this.tagLength),x),!o.equal(F,y.subarray(y.length-this.tagLength,y.length)))return null;var N=y.length-this.tagLength,M;if(P){if(P.length!==N)throw new Error("ChaCha20Poly1305: incorrect destination length");M=P}else M=new Uint8Array(N);return e.streamXOR(this._key,E,y.subarray(0,y.length-this.tagLength),M,4),r.wipe(E),M},h.prototype.clean=function(){return r.wipe(this._key),this},h.prototype._authenticate=function(p,y,x,P){var E=new t.Poly1305(y);P&&(E.update(P),P.length%16>0&&E.update(u.subarray(P.length%16))),E.update(x),x.length%16>0&&E.update(u.subarray(x.length%16));var D=new Uint8Array(8);P&&s.writeUint64LE(P.length,D),E.update(D),s.writeUint64LE(x.length,D),E.update(D);for(var F=E.digest(),N=0;N<F.length;N++)p[N]=F[N];E.clean(),r.wipe(F),r.wipe(D)},h}();i.ChaCha20Poly1305=c})(Br);var ra={},wi={},Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});function Hu(i){return typeof i.saveState!="undefined"&&typeof i.restoreState!="undefined"&&typeof i.cleanSavedState!="undefined"}Kr.isSerializableHash=Hu;Object.defineProperty(wi,"__esModule",{value:!0});var _t=Kr,Bu=$t,Ku=ut,sa=function(){function i(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(r).clean():r.set(t);for(var s=0;s<r.length;s++)r[s]^=54;this._inner.update(r);for(var s=0;s<r.length;s++)r[s]^=106;this._outer.update(r),_t.isSerializableHash(this._inner)&&_t.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Ku.wipe(r)}return i.prototype.reset=function(){if(!_t.isSerializableHash(this._inner)||!_t.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.clean=function(){_t.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),_t.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},i.prototype.update=function(e){return this._inner.update(e),this},i.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(!_t.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},i.prototype.restoreState=function(e){if(!_t.isSerializableHash(this._inner)||!_t.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.cleanSavedState=function(e){if(!_t.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},i}();wi.HMAC=sa;function qu(i,e,t){var r=new sa(i,e);r.update(t);var s=r.digest();return r.clean(),s}wi.hmac=qu;wi.equal=Bu.equal;Object.defineProperty(ra,"__esModule",{value:!0});var Is=wi,Os=ut,Vu=function(){function i(e,t,r,s){r===void 0&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var o=Is.hmac(this._hash,r,t);this._hmac=new Is.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return i.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},i.prototype.expand=function(e){for(var t=new Uint8Array(e),r=0;r<t.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[r]=this._buffer[this._bufpos++];return t},i.prototype.clean=function(){this._hmac.clean(),Os.wipe(this._buffer),Os.wipe(this._counter),this._bufpos=0},i}(),Gu=ra.HKDF=Vu,er={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=ie,t=ut;i.DIGEST_LENGTH=32,i.BLOCK_SIZE=64;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},c.prototype.update=function(h,p){if(p===void 0&&(p=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var y=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&p>0;)this._buffer[this._bufferLength++]=h[y++],p--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(y=o(this._temp,this._state,h,y,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=h[y++],p--;return this},c.prototype.finish=function(h){if(!this._finished){var p=this._bytesHashed,y=this._bufferLength,x=p/536870912|0,P=p<<3,E=p%64<56?64:128;this._buffer[y]=128;for(var D=y+1;D<E-8;D++)this._buffer[D]=0;e.writeUint32BE(x,this._buffer,E-8),e.writeUint32BE(P,this._buffer,E-4),o(this._temp,this._state,this._buffer,0,E),this._finished=!0}for(var D=0;D<this.digestLength/4;D++)e.writeUint32BE(this._state[D],h,D*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.state),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();i.SHA256=r;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,h,p,y,x){for(;x>=64;){for(var P=h[0],E=h[1],D=h[2],F=h[3],N=h[4],M=h[5],_=h[6],S=h[7],d=0;d<16;d++){var w=y+d*4;c[d]=e.readUint32BE(p,w)}for(var d=16;d<64;d++){var b=c[d-2],n=(b>>>17|b<<32-17)^(b>>>19|b<<32-19)^b>>>10;b=c[d-15];var f=(b>>>7|b<<32-7)^(b>>>18|b<<32-18)^b>>>3;c[d]=(n+c[d-7]|0)+(f+c[d-16]|0)}for(var d=0;d<64;d++){var n=(((N>>>6|N<<26)^(N>>>11|N<<21)^(N>>>25|N<<7))+(N&M^~N&_)|0)+(S+(s[d]+c[d]|0)|0)|0,f=((P>>>2|P<<32-2)^(P>>>13|P<<32-13)^(P>>>22|P<<32-22))+(P&E^P&D^E&D)|0;S=_,_=M,M=N,N=F+n|0,F=D,D=E,E=P,P=n+f|0}h[0]+=P,h[1]+=E,h[2]+=D,h[3]+=F,h[4]+=N,h[5]+=M,h[6]+=_,h[7]+=S,y+=64,x-=64}return y}function u(c){var h=new r;h.update(c);var p=h.digest();return h.clean(),p}i.hash=u})(er);var qr={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.sharedKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.scalarMultBase=i.scalarMult=i.SHARED_KEY_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=void 0;const e=ii,t=ut;i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=32,i.SHARED_KEY_LENGTH=32;function r(d){const w=new Float64Array(16);if(d)for(let b=0;b<d.length;b++)w[b]=d[b];return w}const s=new Uint8Array(32);s[0]=9;const o=r([56129,1]);function u(d){let w=1;for(let b=0;b<16;b++){let n=d[b]+w+65535;w=Math.floor(n/65536),d[b]=n-w*65536}d[0]+=w-1+37*(w-1)}function c(d,w,b){const n=~(b-1);for(let f=0;f<16;f++){const U=n&(d[f]^w[f]);d[f]^=U,w[f]^=U}}function h(d,w){const b=r(),n=r();for(let f=0;f<16;f++)n[f]=w[f];u(n),u(n),u(n);for(let f=0;f<2;f++){b[0]=n[0]-65517;for(let z=1;z<15;z++)b[z]=n[z]-65535-(b[z-1]>>16&1),b[z-1]&=65535;b[15]=n[15]-32767-(b[14]>>16&1);const U=b[15]>>16&1;b[14]&=65535,c(n,b,1-U)}for(let f=0;f<16;f++)d[2*f]=n[f]&255,d[2*f+1]=n[f]>>8}function p(d,w){for(let b=0;b<16;b++)d[b]=w[2*b]+(w[2*b+1]<<8);d[15]&=32767}function y(d,w,b){for(let n=0;n<16;n++)d[n]=w[n]+b[n]}function x(d,w,b){for(let n=0;n<16;n++)d[n]=w[n]-b[n]}function P(d,w,b){let n,f,U=0,z=0,Y=0,J=0,X=0,C=0,A=0,k=0,j=0,R=0,L=0,$=0,H=0,re=0,B=0,Q=0,W=0,oe=0,O=0,I=0,m=0,a=0,g=0,K=0,V=0,le=0,be=0,de=0,me=0,Re=0,Ce=0,ye=b[0],pe=b[1],fe=b[2],he=b[3],ce=b[4],ae=b[5],ne=b[6],ee=b[7],ue=b[8],ge=b[9],te=b[10],we=b[11],_e=b[12],De=b[13],Se=b[14],ve=b[15];n=w[0],U+=n*ye,z+=n*pe,Y+=n*fe,J+=n*he,X+=n*ce,C+=n*ae,A+=n*ne,k+=n*ee,j+=n*ue,R+=n*ge,L+=n*te,$+=n*we,H+=n*_e,re+=n*De,B+=n*Se,Q+=n*ve,n=w[1],z+=n*ye,Y+=n*pe,J+=n*fe,X+=n*he,C+=n*ce,A+=n*ae,k+=n*ne,j+=n*ee,R+=n*ue,L+=n*ge,$+=n*te,H+=n*we,re+=n*_e,B+=n*De,Q+=n*Se,W+=n*ve,n=w[2],Y+=n*ye,J+=n*pe,X+=n*fe,C+=n*he,A+=n*ce,k+=n*ae,j+=n*ne,R+=n*ee,L+=n*ue,$+=n*ge,H+=n*te,re+=n*we,B+=n*_e,Q+=n*De,W+=n*Se,oe+=n*ve,n=w[3],J+=n*ye,X+=n*pe,C+=n*fe,A+=n*he,k+=n*ce,j+=n*ae,R+=n*ne,L+=n*ee,$+=n*ue,H+=n*ge,re+=n*te,B+=n*we,Q+=n*_e,W+=n*De,oe+=n*Se,O+=n*ve,n=w[4],X+=n*ye,C+=n*pe,A+=n*fe,k+=n*he,j+=n*ce,R+=n*ae,L+=n*ne,$+=n*ee,H+=n*ue,re+=n*ge,B+=n*te,Q+=n*we,W+=n*_e,oe+=n*De,O+=n*Se,I+=n*ve,n=w[5],C+=n*ye,A+=n*pe,k+=n*fe,j+=n*he,R+=n*ce,L+=n*ae,$+=n*ne,H+=n*ee,re+=n*ue,B+=n*ge,Q+=n*te,W+=n*we,oe+=n*_e,O+=n*De,I+=n*Se,m+=n*ve,n=w[6],A+=n*ye,k+=n*pe,j+=n*fe,R+=n*he,L+=n*ce,$+=n*ae,H+=n*ne,re+=n*ee,B+=n*ue,Q+=n*ge,W+=n*te,oe+=n*we,O+=n*_e,I+=n*De,m+=n*Se,a+=n*ve,n=w[7],k+=n*ye,j+=n*pe,R+=n*fe,L+=n*he,$+=n*ce,H+=n*ae,re+=n*ne,B+=n*ee,Q+=n*ue,W+=n*ge,oe+=n*te,O+=n*we,I+=n*_e,m+=n*De,a+=n*Se,g+=n*ve,n=w[8],j+=n*ye,R+=n*pe,L+=n*fe,$+=n*he,H+=n*ce,re+=n*ae,B+=n*ne,Q+=n*ee,W+=n*ue,oe+=n*ge,O+=n*te,I+=n*we,m+=n*_e,a+=n*De,g+=n*Se,K+=n*ve,n=w[9],R+=n*ye,L+=n*pe,$+=n*fe,H+=n*he,re+=n*ce,B+=n*ae,Q+=n*ne,W+=n*ee,oe+=n*ue,O+=n*ge,I+=n*te,m+=n*we,a+=n*_e,g+=n*De,K+=n*Se,V+=n*ve,n=w[10],L+=n*ye,$+=n*pe,H+=n*fe,re+=n*he,B+=n*ce,Q+=n*ae,W+=n*ne,oe+=n*ee,O+=n*ue,I+=n*ge,m+=n*te,a+=n*we,g+=n*_e,K+=n*De,V+=n*Se,le+=n*ve,n=w[11],$+=n*ye,H+=n*pe,re+=n*fe,B+=n*he,Q+=n*ce,W+=n*ae,oe+=n*ne,O+=n*ee,I+=n*ue,m+=n*ge,a+=n*te,g+=n*we,K+=n*_e,V+=n*De,le+=n*Se,be+=n*ve,n=w[12],H+=n*ye,re+=n*pe,B+=n*fe,Q+=n*he,W+=n*ce,oe+=n*ae,O+=n*ne,I+=n*ee,m+=n*ue,a+=n*ge,g+=n*te,K+=n*we,V+=n*_e,le+=n*De,be+=n*Se,de+=n*ve,n=w[13],re+=n*ye,B+=n*pe,Q+=n*fe,W+=n*he,oe+=n*ce,O+=n*ae,I+=n*ne,m+=n*ee,a+=n*ue,g+=n*ge,K+=n*te,V+=n*we,le+=n*_e,be+=n*De,de+=n*Se,me+=n*ve,n=w[14],B+=n*ye,Q+=n*pe,W+=n*fe,oe+=n*he,O+=n*ce,I+=n*ae,m+=n*ne,a+=n*ee,g+=n*ue,K+=n*ge,V+=n*te,le+=n*we,be+=n*_e,de+=n*De,me+=n*Se,Re+=n*ve,n=w[15],Q+=n*ye,W+=n*pe,oe+=n*fe,O+=n*he,I+=n*ce,m+=n*ae,a+=n*ne,g+=n*ee,K+=n*ue,V+=n*ge,le+=n*te,be+=n*we,de+=n*_e,me+=n*De,Re+=n*Se,Ce+=n*ve,U+=38*W,z+=38*oe,Y+=38*O,J+=38*I,X+=38*m,C+=38*a,A+=38*g,k+=38*K,j+=38*V,R+=38*le,L+=38*be,$+=38*de,H+=38*me,re+=38*Re,B+=38*Ce,f=1,n=U+f+65535,f=Math.floor(n/65536),U=n-f*65536,n=z+f+65535,f=Math.floor(n/65536),z=n-f*65536,n=Y+f+65535,f=Math.floor(n/65536),Y=n-f*65536,n=J+f+65535,f=Math.floor(n/65536),J=n-f*65536,n=X+f+65535,f=Math.floor(n/65536),X=n-f*65536,n=C+f+65535,f=Math.floor(n/65536),C=n-f*65536,n=A+f+65535,f=Math.floor(n/65536),A=n-f*65536,n=k+f+65535,f=Math.floor(n/65536),k=n-f*65536,n=j+f+65535,f=Math.floor(n/65536),j=n-f*65536,n=R+f+65535,f=Math.floor(n/65536),R=n-f*65536,n=L+f+65535,f=Math.floor(n/65536),L=n-f*65536,n=$+f+65535,f=Math.floor(n/65536),$=n-f*65536,n=H+f+65535,f=Math.floor(n/65536),H=n-f*65536,n=re+f+65535,f=Math.floor(n/65536),re=n-f*65536,n=B+f+65535,f=Math.floor(n/65536),B=n-f*65536,n=Q+f+65535,f=Math.floor(n/65536),Q=n-f*65536,U+=f-1+37*(f-1),f=1,n=U+f+65535,f=Math.floor(n/65536),U=n-f*65536,n=z+f+65535,f=Math.floor(n/65536),z=n-f*65536,n=Y+f+65535,f=Math.floor(n/65536),Y=n-f*65536,n=J+f+65535,f=Math.floor(n/65536),J=n-f*65536,n=X+f+65535,f=Math.floor(n/65536),X=n-f*65536,n=C+f+65535,f=Math.floor(n/65536),C=n-f*65536,n=A+f+65535,f=Math.floor(n/65536),A=n-f*65536,n=k+f+65535,f=Math.floor(n/65536),k=n-f*65536,n=j+f+65535,f=Math.floor(n/65536),j=n-f*65536,n=R+f+65535,f=Math.floor(n/65536),R=n-f*65536,n=L+f+65535,f=Math.floor(n/65536),L=n-f*65536,n=$+f+65535,f=Math.floor(n/65536),$=n-f*65536,n=H+f+65535,f=Math.floor(n/65536),H=n-f*65536,n=re+f+65535,f=Math.floor(n/65536),re=n-f*65536,n=B+f+65535,f=Math.floor(n/65536),B=n-f*65536,n=Q+f+65535,f=Math.floor(n/65536),Q=n-f*65536,U+=f-1+37*(f-1),d[0]=U,d[1]=z,d[2]=Y,d[3]=J,d[4]=X,d[5]=C,d[6]=A,d[7]=k,d[8]=j,d[9]=R,d[10]=L,d[11]=$,d[12]=H,d[13]=re,d[14]=B,d[15]=Q}function E(d,w){P(d,w,w)}function D(d,w){const b=r();for(let n=0;n<16;n++)b[n]=w[n];for(let n=253;n>=0;n--)E(b,b),n!==2&&n!==4&&P(b,b,w);for(let n=0;n<16;n++)d[n]=b[n]}function F(d,w){const b=new Uint8Array(32),n=new Float64Array(80),f=r(),U=r(),z=r(),Y=r(),J=r(),X=r();for(let j=0;j<31;j++)b[j]=d[j];b[31]=d[31]&127|64,b[0]&=248,p(n,w);for(let j=0;j<16;j++)U[j]=n[j];f[0]=Y[0]=1;for(let j=254;j>=0;--j){const R=b[j>>>3]>>>(j&7)&1;c(f,U,R),c(z,Y,R),y(J,f,z),x(f,f,z),y(z,U,Y),x(U,U,Y),E(Y,J),E(X,f),P(f,z,f),P(z,U,J),y(J,f,z),x(f,f,z),E(U,f),x(z,Y,X),P(f,z,o),y(f,f,Y),P(z,z,f),P(f,Y,X),P(Y,U,n),E(U,J),c(f,U,R),c(z,Y,R)}for(let j=0;j<16;j++)n[j+16]=f[j],n[j+32]=z[j],n[j+48]=U[j],n[j+64]=Y[j];const C=n.subarray(32),A=n.subarray(16);D(C,C),P(A,A,C);const k=new Uint8Array(32);return h(k,A),k}i.scalarMult=F;function N(d){return F(d,s)}i.scalarMultBase=N;function M(d){if(d.length!==i.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${i.SECRET_KEY_LENGTH} bytes`);const w=new Uint8Array(d);return{publicKey:N(w),secretKey:w}}i.generateKeyPairFromSeed=M;function _(d){const w=(0,e.randomBytes)(32,d),b=M(w);return(0,t.wipe)(w),b}i.generateKeyPair=_;function S(d,w,b=!1){if(d.length!==i.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(w.length!==i.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=F(d,w);if(b){let f=0;for(let U=0;U<n.length;U++)f|=n[U];if(f===0)throw new Error("X25519: invalid shared key")}return n}i.sharedKey=S})(qr);var As=globalThis&&globalThis.__spreadArray||function(i,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||Array.prototype.slice.call(e))},ku=function(){function i(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"}return i}(),Wu=function(){function i(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return i}(),Yu=function(){function i(e,t,r,s){this.name=e,this.version=t,this.os=r,this.bot=s,this.type="bot-device"}return i}(),Ju=function(){function i(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return i}(),Xu=function(){function i(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return i}(),Zu=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Qu=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Cs=3,el=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Zu]],Ps=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function tl(i){return i?Ns(i):typeof document=="undefined"&&typeof navigator!="undefined"&&navigator.product==="ReactNative"?new Xu:typeof navigator!="undefined"?Ns(navigator.userAgent):sl()}function il(i){return i!==""&&el.reduce(function(e,t){var r=t[0],s=t[1];if(e)return e;var o=s.exec(i);return!!o&&[r,o]},!1)}function Ns(i){var e=il(i);if(!e)return null;var t=e[0],r=e[1];if(t==="searchbot")return new Ju;var s=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);s?s.length<Cs&&(s=As(As([],s,!0),nl(Cs-s.length),!0)):s=[];var o=s.join("."),u=rl(i),c=Qu.exec(i);return c&&c[1]?new Yu(t,o,u,c[1]):new ku(t,o,u)}function rl(i){for(var e=0,t=Ps.length;e<t;e++){var r=Ps[e],s=r[0],o=r[1],u=o.exec(i);if(u)return s}return null}function sl(){var i=typeof process!="undefined"&&process.version;return i?new Wu(process.version.slice(1)):null}function nl(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}var Vr={};Object.defineProperty(Vr,"__esModule",{value:!0});var na=Vr.getWindowMetadata=void 0;const Ts=xo;function al(){let i,e;try{i=Ts.getDocumentOrThrow(),e=Ts.getLocationOrThrow()}catch{return null}function t(){const x=i.getElementsByTagName("link"),P=[];for(let E=0;E<x.length;E++){const D=x[E],F=D.getAttribute("rel");if(F&&F.toLowerCase().indexOf("icon")>-1){const N=D.getAttribute("href");if(N)if(N.toLowerCase().indexOf("https:")===-1&&N.toLowerCase().indexOf("http:")===-1&&N.indexOf("//")!==0){let M=e.protocol+"//"+e.host;if(N.indexOf("/")===0)M+=N;else{const _=e.pathname.split("/");_.pop(),M+=_.join("/")+"/"+N}P.push(M)}else if(N.indexOf("//")===0){const M=e.protocol+N;P.push(M)}else P.push(N)}}return P}function r(...x){const P=i.getElementsByTagName("meta");for(let E=0;E<P.length;E++){const D=P[E],F=["itemprop","property","name"].map(N=>D.getAttribute(N)).filter(N=>N?x.includes(N):!1);if(F.length&&F){const N=D.getAttribute("content");if(N)return N}}return""}function s(){let x=r("name","og:site_name","og:title","twitter:title");return x||(x=i.title),x}function o(){return r("description","og:description","twitter:description","keywords")}const u=s(),c=o(),h=e.origin,p=t();return{description:c,url:h,icons:p,name:u}}na=Vr.getWindowMetadata=al;var li={},ol=function(i,e){for(var t={},r=Object.keys(i),s=Array.isArray(e),o=0;o<r.length;o++){var u=r[o],c=i[u];(s?e.indexOf(u)!==-1:e(u,c,i))&&(t[u]=c)}return t};(function(i){const e=Oo,t=Ao,r=Io,s=ol,o=_=>_==null,u=Symbol("encodeFragmentIdentifier");function c(_){switch(_.arrayFormat){case"index":return S=>(d,w)=>{const b=d.length;return w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?d:w===null?[...d,[y(S,_),"[",b,"]"].join("")]:[...d,[y(S,_),"[",y(b,_),"]=",y(w,_)].join("")]};case"bracket":return S=>(d,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?d:w===null?[...d,[y(S,_),"[]"].join("")]:[...d,[y(S,_),"[]=",y(w,_)].join("")];case"colon-list-separator":return S=>(d,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?d:w===null?[...d,[y(S,_),":list="].join("")]:[...d,[y(S,_),":list=",y(w,_)].join("")];case"comma":case"separator":case"bracket-separator":{const S=_.arrayFormat==="bracket-separator"?"[]=":"=";return d=>(w,b)=>b===void 0||_.skipNull&&b===null||_.skipEmptyString&&b===""?w:(b=b===null?"":b,w.length===0?[[y(d,_),S,y(b,_)].join("")]:[[w,y(b,_)].join(_.arrayFormatSeparator)])}default:return S=>(d,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?d:w===null?[...d,y(S,_)]:[...d,[y(S,_),"=",y(w,_)].join("")]}}function h(_){let S;switch(_.arrayFormat){case"index":return(d,w,b)=>{if(S=/\[(\d*)\]$/.exec(d),d=d.replace(/\[\d*\]$/,""),!S){b[d]=w;return}b[d]===void 0&&(b[d]={}),b[d][S[1]]=w};case"bracket":return(d,w,b)=>{if(S=/(\[\])$/.exec(d),d=d.replace(/\[\]$/,""),!S){b[d]=w;return}if(b[d]===void 0){b[d]=[w];return}b[d]=[].concat(b[d],w)};case"colon-list-separator":return(d,w,b)=>{if(S=/(:list)$/.exec(d),d=d.replace(/:list$/,""),!S){b[d]=w;return}if(b[d]===void 0){b[d]=[w];return}b[d]=[].concat(b[d],w)};case"comma":case"separator":return(d,w,b)=>{const n=typeof w=="string"&&w.includes(_.arrayFormatSeparator),f=typeof w=="string"&&!n&&x(w,_).includes(_.arrayFormatSeparator);w=f?x(w,_):w;const U=n||f?w.split(_.arrayFormatSeparator).map(z=>x(z,_)):w===null?w:x(w,_);b[d]=U};case"bracket-separator":return(d,w,b)=>{const n=/(\[\])$/.test(d);if(d=d.replace(/\[\]$/,""),!n){b[d]=w&&x(w,_);return}const f=w===null?[]:w.split(_.arrayFormatSeparator).map(U=>x(U,_));if(b[d]===void 0){b[d]=f;return}b[d]=[].concat(b[d],f)};default:return(d,w,b)=>{if(b[d]===void 0){b[d]=w;return}b[d]=[].concat(b[d],w)}}}function p(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function y(_,S){return S.encode?S.strict?e(_):encodeURIComponent(_):_}function x(_,S){return S.decode?t(_):_}function P(_){return Array.isArray(_)?_.sort():typeof _=="object"?P(Object.keys(_)).sort((S,d)=>Number(S)-Number(d)).map(S=>_[S]):_}function E(_){const S=_.indexOf("#");return S!==-1&&(_=_.slice(0,S)),_}function D(_){let S="";const d=_.indexOf("#");return d!==-1&&(S=_.slice(d)),S}function F(_){_=E(_);const S=_.indexOf("?");return S===-1?"":_.slice(S+1)}function N(_,S){return S.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):S.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function M(_,S){S=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},S),p(S.arrayFormatSeparator);const d=h(S),w=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return w;for(const b of _.split("&")){if(b==="")continue;let[n,f]=r(S.decode?b.replace(/\+/g," "):b,"=");f=f===void 0?null:["comma","separator","bracket-separator"].includes(S.arrayFormat)?f:x(f,S),d(x(n,S),f,w)}for(const b of Object.keys(w)){const n=w[b];if(typeof n=="object"&&n!==null)for(const f of Object.keys(n))n[f]=N(n[f],S);else w[b]=N(n,S)}return S.sort===!1?w:(S.sort===!0?Object.keys(w).sort():Object.keys(w).sort(S.sort)).reduce((b,n)=>{const f=w[n];return Boolean(f)&&typeof f=="object"&&!Array.isArray(f)?b[n]=P(f):b[n]=f,b},Object.create(null))}i.extract=F,i.parse=M,i.stringify=(_,S)=>{if(!_)return"";S=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},S),p(S.arrayFormatSeparator);const d=f=>S.skipNull&&o(_[f])||S.skipEmptyString&&_[f]==="",w=c(S),b={};for(const f of Object.keys(_))d(f)||(b[f]=_[f]);const n=Object.keys(b);return S.sort!==!1&&n.sort(S.sort),n.map(f=>{const U=_[f];return U===void 0?"":U===null?y(f,S):Array.isArray(U)?U.length===0&&S.arrayFormat==="bracket-separator"?y(f,S)+"[]":U.reduce(w(f),[]).join("&"):y(f,S)+"="+y(U,S)}).filter(f=>f.length>0).join("&")},i.parseUrl=(_,S)=>{S=Object.assign({decode:!0},S);const[d,w]=r(_,"#");return Object.assign({url:d.split("?")[0]||"",query:M(F(_),S)},S&&S.parseFragmentIdentifier&&w?{fragmentIdentifier:x(w,S)}:{})},i.stringifyUrl=(_,S)=>{S=Object.assign({encode:!0,strict:!0,[u]:!0},S);const d=E(_.url).split("?")[0]||"",w=i.extract(_.url),b=i.parse(w,{sort:!1}),n=Object.assign(b,_.query);let f=i.stringify(n,S);f&&(f=`?${f}`);let U=D(_.url);return _.fragmentIdentifier&&(U=`#${S[u]?y(_.fragmentIdentifier,S):_.fragmentIdentifier}`),`${d}${f}${U}`},i.pick=(_,S,d)=>{d=Object.assign({parseFragmentIdentifier:!0,[u]:!1},d);const{url:w,query:b,fragmentIdentifier:n}=i.parseUrl(_,d);return i.stringifyUrl({url:w,query:s(b,S),fragmentIdentifier:n},d)},i.exclude=(_,S,d)=>{const w=Array.isArray(S)?b=>!S.includes(b):(b,n)=>!S(b,n);return i.pick(_,w,d)}})(li);const cl={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},aa="base10",at="base16",Er="base64pad",Gr="utf8",oa=0,kt=1,hl=0,Rs=1,Dr=12,kr=32;function ul(){const i=qr.generateKeyPair();return{privateKey:ot(i.secretKey,at),publicKey:ot(i.publicKey,at)}}function Sr(){const i=ii.randomBytes(kr);return ot(i,at)}function ll(i,e){const t=qr.sharedKey(nt(i,at),nt(e,at)),r=new Gu(er.SHA256,t).expand(kr);return ot(r,at)}function fl(i){const e=er.hash(nt(i,at));return ot(e,at)}function xr(i){const e=er.hash(nt(i,Gr));return ot(e,at)}function dl(i){return nt(`${i}`,aa)}function _i(i){return Number(ot(i,aa))}function pl(i){const e=dl(typeof i.type<"u"?i.type:oa);if(_i(e)===kt&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?nt(i.senderPublicKey,at):void 0,r=typeof i.iv<"u"?nt(i.iv,at):ii.randomBytes(Dr),s=new Br.ChaCha20Poly1305(nt(i.symKey,at)).seal(r,nt(i.message,Gr));return yl({type:e,sealed:s,iv:r,senderPublicKey:t})}function gl(i){const e=new Br.ChaCha20Poly1305(nt(i.symKey,at)),{sealed:t,iv:r}=Wr(i.encoded),s=e.open(r,t);if(s===null)throw new Error("Failed to decrypt");return ot(s,Gr)}function yl(i){if(_i(i.type)===kt){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ot(wr([i.type,i.senderPublicKey,i.iv,i.sealed]),Er)}return ot(wr([i.type,i.iv,i.sealed]),Er)}function Wr(i){const e=nt(i,Er),t=e.slice(hl,Rs),r=Rs;if(_i(t)===kt){const c=r+kr,h=c+Dr,p=e.slice(r,c),y=e.slice(c,h),x=e.slice(h);return{type:t,sealed:x,iv:y,senderPublicKey:p}}const s=r+Dr,o=e.slice(r,s),u=e.slice(s);return{type:t,sealed:u,iv:o}}function bl(i,e){const t=Wr(i);return ca({type:_i(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ot(t.senderPublicKey,at):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function ca(i){const e=(i==null?void 0:i.type)||oa;if(e===kt){if(typeof(i==null?void 0:i.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(i==null?void 0:i.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i==null?void 0:i.senderPublicKey,receiverPublicKey:i==null?void 0:i.receiverPublicKey}}function Fs(i){return i.type===kt&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}var wl=Object.defineProperty,Us=Object.getOwnPropertySymbols,_l=Object.prototype.hasOwnProperty,ml=Object.prototype.propertyIsEnumerable,Ls=(i,e,t)=>e in i?wl(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ms=(i,e)=>{for(var t in e||(e={}))_l.call(e,t)&&Ls(i,t,e[t]);if(Us)for(var t of Us(e))ml.call(e,t)&&Ls(i,t,e[t]);return i};const vl="ReactNative",ci={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},El="js";function ha(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Dl(){return!Po()&&!!yn()&&navigator.product===vl}function Sl(){return!ha()&&!!yn()}function xl(){return Dl()?ci.reactNative:ha()?ci.node:Sl()?ci.browser:ci.unknown}function Il(i,e){let t=li.parse(i);return t=Ms(Ms({},t),e),i=li.stringify(t),i}function Ol(){return na()||{name:"",description:"",url:"",icons:[""]}}function Al(){const i=tl();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function Cl(){var i;const e=xl();return e===ci.browser?[e,((i=Co())==null?void 0:i.host)||"unknown"].join(":"):e}function Pl(i,e,t){const r=Al(),s=Cl();return[[i,e].join("-"),[El,t].join("-"),r,s].join("/")}function Nl({protocol:i,version:e,relayUrl:t,sdkVersion:r,auth:s,projectId:o}){const u=t.split("?"),c=Pl(i,e,r),h={auth:s,ua:c,projectId:o},p=Il(u[1]||"",h);return u[0]+"?"+p}function Ut(i,e){return i.filter(t=>e.includes(t)).length===i.length}function ua(i){return Object.fromEntries(i.entries())}function la(i){return new Map(Object.entries(i))}function Et(i,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(i))}function Ft(i){return Z.fromMiliseconds(Date.now())>=Z.toMiliseconds(i)}function Kt(i){const e=Z.toMiliseconds(i||Z.FIVE_MINUTES);let t,r,s;return{resolve:o=>{s&&t&&(clearTimeout(s),t(o))},reject:o=>{s&&r&&(clearTimeout(s),r(o))},done:()=>new Promise((o,u)=>{s=setTimeout(u,e),t=o,r=u})}}function fa(i,e){return new Promise(async(t,r)=>{const s=setTimeout(()=>r(),e),o=await i;clearTimeout(s),t(o)})}function da(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function Tl(i){return da("topic",i)}function Rl(i){return da("id",i)}function pa(i){const[e,t]=i.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")r.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return r}function Fe(i,e){return`${i}${e?`:${e}`:""}`}const Fl="irn";function Ir(i){return(i==null?void 0:i.relay)||{protocol:Fl}}function Or(i){const e=cl[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}var Ul=Object.defineProperty,$s=Object.getOwnPropertySymbols,Ll=Object.prototype.hasOwnProperty,Ml=Object.prototype.propertyIsEnumerable,js=(i,e,t)=>e in i?Ul(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$l=(i,e)=>{for(var t in e||(e={}))Ll.call(e,t)&&js(i,t,e[t]);if($s)for(var t of $s(e))Ml.call(e,t)&&js(i,t,e[t]);return i};function jl(i,e="-"){const t={},r="relay"+e;return Object.keys(i).forEach(s=>{if(s.startsWith(r)){const o=s.replace(r,""),u=i[s];t[o]=u}}),t}function zl(i){const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,r=i.substring(0,e),s=i.substring(e+1,t).split("@"),o=typeof t<"u"?i.substring(t):"",u=li.parse(o);return{protocol:r,topic:s[0],version:parseInt(s[1],10),symKey:u.symKey,relay:jl(u)}}function Hl(i,e="-"){const t="relay",r={};return Object.keys(i).forEach(s=>{const o=t+e+s;i[s]&&(r[o]=i[s])}),r}function Bl(i){return`${i.protocol}:${i.topic}@${i.version}?`+li.stringify($l({symKey:i.symKey},Hl(i.relay)))}function mi(i){const e=[];return i.forEach(t=>{const[r,s]=t.split(":");e.push(`${r}:${s}`)}),e}function Kl(i){const e=[];return Object.values(i).forEach(t=>{e.push(...mi(t.accounts))}),e}function ql(i,e){const t=[];return Object.values(i).forEach(r=>{mi(r.accounts).includes(e)&&t.push(...r.methods)}),t}function Vl(i,e){const t=[];return Object.values(i).forEach(r=>{mi(r.accounts).includes(e)&&t.push(...r.events)}),t}function Gl(i,e){const t=Ui(i,e);if(t)throw new Error(t.message);const r={};for(const[s,o]of Object.entries(i))r[s]={methods:o.methods,events:o.events,chains:o.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return r}const kl={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Wl={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(i,e){const{message:t,code:r}=Wl[i];return{message:e?`${t} ${e}`:t,code:r}}function He(i,e){const{message:t,code:r}=kl[i];return{message:e?`${t} ${e}`:t,code:r}}function vi(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}function ji(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function pt(i){return typeof i>"u"}function Xe(i,e){return e&&pt(i)?!0:typeof i=="string"&&Boolean(i.trim().length)}function Yr(i,e){return e&&pt(i)?!0:typeof i=="number"&&!isNaN(i)}function Yl(i,e){const{requiredNamespaces:t}=e,r=Object.keys(i.namespaces),s=Object.keys(t);let o=!0;return Ut(s,r)?(r.forEach(u=>{const{accounts:c,methods:h,events:p}=i.namespaces[u],y=mi(c),x=t[u];(!Ut(x.chains,y)||!Ut(x.methods,h)||!Ut(x.events,p))&&(o=!1)}),o):!1}function Jr(i){return Xe(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function Jl(i){if(Xe(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Jr(t)}}return!1}function Xl(i){if(Xe(i,!1))try{return typeof new URL(i)<"u"}catch{return!1}return!1}function Zl(i){var e;return(e=i==null?void 0:i.proposer)==null?void 0:e.publicKey}function Ql(i){return i==null?void 0:i.topic}function ef(i,e){let t=null;return Xe(i==null?void 0:i.publicKey,!1)||(t=q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function zs(i){let e=!0;return vi(i)?i.length&&(e=i.every(t=>Xe(t,!1))):e=!1,e}function tf(i,e,t){let r=null;return vi(e)?e.forEach(s=>{r||(!Jr(s)||!s.includes(i))&&(r=He("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):r=He("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),r}function rf(i,e){let t=null;return Object.entries(i).forEach(([r,s])=>{if(t)return;const o=tf(r,s==null?void 0:s.chains,`${e} requiredNamespace`);o&&(t=o)}),t}function sf(i,e){let t=null;return vi(i)?i.forEach(r=>{t||Jl(r)||(t=He("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=He("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function nf(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=sf(r==null?void 0:r.accounts,`${e} namespace`);s&&(t=s)}),t}function af(i,e){let t=null;return zs(i==null?void 0:i.methods)?zs(i==null?void 0:i.events)||(t=He("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=He("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function ga(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=af(r,`${e}, namespace`);s&&(t=s)}),t}function of(i,e){let t=null;if(i&&ji(i)){const r=ga(i,e);r&&(t=r);const s=rf(i,e);s&&(t=s)}else t=q("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return t}function Ui(i,e){let t=null;if(i&&ji(i)){const r=ga(i,e);r&&(t=r);const s=nf(i,e);s&&(t=s)}else t=q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function ya(i){return Xe(i.protocol,!0)}function cf(i,e){let t=!1;return e&&!i?t=!0:i&&vi(i)&&i.length&&i.forEach(r=>{t=ya(r)}),t}function hf(i){return typeof i=="number"}function rt(i){return typeof i<"u"&&typeof i!==null}function uf(i){return!(!i||typeof i!="object"||!i.code||!Yr(i.code,!1)||!i.message||!Xe(i.message,!1))}function lf(i){return!(pt(i)||!Xe(i.method,!1))}function ff(i){return!(pt(i)||pt(i.result)&&pt(i.error)||!Yr(i.id,!1)||!Xe(i.jsonrpc,!1))}function df(i){return!(pt(i)||!Xe(i.name,!1))}function Hs(i,e){return!(!Jr(e)||!Kl(i).includes(e))}function pf(i,e,t){return Xe(t,!1)?ql(i,e).includes(t):!1}function gf(i,e,t){return Xe(t,!1)?Vl(i,e).includes(t):!1}function Bs(i,e,t){let r=null;const s=Object.keys(i),o=Object.keys(e);return Ut(s,o)?s.forEach(u=>{if(r)return;const c=i[u].chains,h=mi(e[u].accounts);Ut(c,h)?Ut(i[u].methods,e[u].methods)?Ut(i[u].events,e[u].events)||(r=q("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy requiredNamespaces events for ${u}`)):r=q("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy requiredNamespaces methods for ${u}`):r=q("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy requiredNamespaces chains for ${u}`)}):r=q("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces`),r}function yf(i,e){return Yr(i,!1)&&i<=e.max&&i>=e.min}const Ks=10,bf=()=>typeof global!="undefined"&&typeof global.WebSocket!="undefined"?global.WebSocket:typeof window!="undefined"&&typeof window.WebSocket!="undefined"?window.WebSocket:require("ws"),wf=()=>typeof window!="undefined",_f=bf();class mf{constructor(e){if(this.url=e,this.events=new At.exports.EventEmitter,this.registering=!1,!ps(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket!="undefined"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket=="undefined"){t(new Error("Connection already closed"));return}this.socket.onclose=()=>{this.onClose(),e()},this.socket.close()})}async send(e,t){typeof this.socket=="undefined"&&(this.socket=await this.register());try{this.socket.send(Tr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!ps(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket=="undefined")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const s=No.isReactNative()?void 0:{rejectUnauthorized:!To(e)},o=new _f(e,[],s);wf()?o.onerror=u=>{const c=u;r(this.emitError(c.error))}:o.on("error",u=>{r(this.emitError(u))}),o.onopen=()=>{this.onOpen(o),t(o)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data=="undefined")return;const t=typeof e.data=="string"?bn(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),o=Rr(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return Ro(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ks&&this.events.setMaxListeners(Ks)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var Ar={exports:{}};(function(i,e){var t=200,r="__lodash_hash_undefined__",s=1,o=2,u=9007199254740991,c="[object Arguments]",h="[object Array]",p="[object AsyncFunction]",y="[object Boolean]",x="[object Date]",P="[object Error]",E="[object Function]",D="[object GeneratorFunction]",F="[object Map]",N="[object Number]",M="[object Null]",_="[object Object]",S="[object Promise]",d="[object Proxy]",w="[object RegExp]",b="[object Set]",n="[object String]",f="[object Symbol]",U="[object Undefined]",z="[object WeakMap]",Y="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",C="[object Float64Array]",A="[object Int8Array]",k="[object Int16Array]",j="[object Int32Array]",R="[object Uint8Array]",L="[object Uint8ClampedArray]",$="[object Uint16Array]",H="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,W={};W[X]=W[C]=W[A]=W[k]=W[j]=W[R]=W[L]=W[$]=W[H]=!0,W[c]=W[h]=W[Y]=W[y]=W[J]=W[x]=W[P]=W[E]=W[F]=W[N]=W[_]=W[w]=W[b]=W[n]=W[z]=!1;var oe=typeof qt=="object"&&qt&&qt.Object===Object&&qt,O=typeof self=="object"&&self&&self.Object===Object&&self,I=oe||O||Function("return this")(),m=e&&!e.nodeType&&e,a=m&&!0&&i&&!i.nodeType&&i,g=a&&a.exports===m,K=g&&oe.process,V=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),le=V&&V.isTypedArray;function be(l,v){for(var T=-1,G=l==null?0:l.length,Ie=0,se=[];++T<G;){var Te=l[T];v(Te,T,l)&&(se[Ie++]=Te)}return se}function de(l,v){for(var T=-1,G=v.length,Ie=l.length;++T<G;)l[Ie+T]=v[T];return l}function me(l,v){for(var T=-1,G=l==null?0:l.length;++T<G;)if(v(l[T],T,l))return!0;return!1}function Re(l,v){for(var T=-1,G=Array(l);++T<l;)G[T]=v(T);return G}function Ce(l){return function(v){return l(v)}}function ye(l,v){return l.has(v)}function pe(l,v){return l==null?void 0:l[v]}function fe(l){var v=-1,T=Array(l.size);return l.forEach(function(G,Ie){T[++v]=[Ie,G]}),T}function he(l,v){return function(T){return l(v(T))}}function ce(l){var v=-1,T=Array(l.size);return l.forEach(function(G){T[++v]=G}),T}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=I["__core-js_shared__"],ge=ne.toString,te=ee.hasOwnProperty,we=function(){var l=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),_e=ee.toString,De=RegExp("^"+ge.call(te).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=g?I.Buffer:void 0,ve=I.Symbol,gt=I.Uint8Array,wt=ee.propertyIsEnumerable,Ct=ae.splice,ct=ve?ve.toStringTag:void 0,jt=Object.getOwnPropertySymbols,ri=Se?Se.isBuffer:void 0,Di=he(Object.keys,Object),Ue=Wt(I,"DataView"),Pe=Wt(I,"Map"),Le=Wt(I,"Promise"),Me=Wt(I,"Set"),$e=Wt(I,"WeakMap"),Ne=Wt(Object,"create"),Be=Ht(Ue),Ke=Ht(Pe),qe=Ht(Le),Ve=Ht(Me),Ge=Ht($e),ze=ve?ve.prototype:void 0,je=ze?ze.valueOf:void 0;function Oe(l){var v=-1,T=l==null?0:l.length;for(this.clear();++v<T;){var G=l[v];this.set(G[0],G[1])}}function ke(){this.__data__=Ne?Ne(null):{},this.size=0}function We(l){var v=this.has(l)&&delete this.__data__[l];return this.size-=v?1:0,v}function Ta(l){var v=this.__data__;if(Ne){var T=v[l];return T===r?void 0:T}return te.call(v,l)?v[l]:void 0}function Ra(l){var v=this.__data__;return Ne?v[l]!==void 0:te.call(v,l)}function Fa(l,v){var T=this.__data__;return this.size+=this.has(l)?0:1,T[l]=Ne&&v===void 0?r:v,this}Oe.prototype.clear=ke,Oe.prototype.delete=We,Oe.prototype.get=Ta,Oe.prototype.has=Ra,Oe.prototype.set=Fa;function St(l){var v=-1,T=l==null?0:l.length;for(this.clear();++v<T;){var G=l[v];this.set(G[0],G[1])}}function Ua(){this.__data__=[],this.size=0}function La(l){var v=this.__data__,T=xi(v,l);if(T<0)return!1;var G=v.length-1;return T==G?v.pop():Ct.call(v,T,1),--this.size,!0}function Ma(l){var v=this.__data__,T=xi(v,l);return T<0?void 0:v[T][1]}function $a(l){return xi(this.__data__,l)>-1}function ja(l,v){var T=this.__data__,G=xi(T,l);return G<0?(++this.size,T.push([l,v])):T[G][1]=v,this}St.prototype.clear=Ua,St.prototype.delete=La,St.prototype.get=Ma,St.prototype.has=$a,St.prototype.set=ja;function zt(l){var v=-1,T=l==null?0:l.length;for(this.clear();++v<T;){var G=l[v];this.set(G[0],G[1])}}function za(){this.size=0,this.__data__={hash:new Oe,map:new(Pe||St),string:new Oe}}function Ha(l){var v=Ii(this,l).delete(l);return this.size-=v?1:0,v}function Ba(l){return Ii(this,l).get(l)}function Ka(l){return Ii(this,l).has(l)}function qa(l,v){var T=Ii(this,l),G=T.size;return T.set(l,v),this.size+=T.size==G?0:1,this}zt.prototype.clear=za,zt.prototype.delete=Ha,zt.prototype.get=Ba,zt.prototype.has=Ka,zt.prototype.set=qa;function Si(l){var v=-1,T=l==null?0:l.length;for(this.__data__=new zt;++v<T;)this.add(l[v])}function Va(l){return this.__data__.set(l,r),this}function Ga(l){return this.__data__.has(l)}Si.prototype.add=Si.prototype.push=Va,Si.prototype.has=Ga;function Pt(l){var v=this.__data__=new St(l);this.size=v.size}function ka(){this.__data__=new St,this.size=0}function Wa(l){var v=this.__data__,T=v.delete(l);return this.size=v.size,T}function Ya(l){return this.__data__.get(l)}function Ja(l){return this.__data__.has(l)}function Xa(l,v){var T=this.__data__;if(T instanceof St){var G=T.__data__;if(!Pe||G.length<t-1)return G.push([l,v]),this.size=++T.size,this;T=this.__data__=new zt(G)}return T.set(l,v),this.size=T.size,this}Pt.prototype.clear=ka,Pt.prototype.delete=Wa,Pt.prototype.get=Ya,Pt.prototype.has=Ja,Pt.prototype.set=Xa;function Za(l,v){var T=Oi(l),G=!T&&po(l),Ie=!T&&!G&&rr(l),se=!T&&!G&&!Ie&&us(l),Te=T||G||Ie||se,Ye=Te?Re(l.length,String):[],Je=Ye.length;for(var Ae in l)(v||te.call(l,Ae))&&!(Te&&(Ae=="length"||Ie&&(Ae=="offset"||Ae=="parent")||se&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||co(Ae,Je)))&&Ye.push(Ae);return Ye}function xi(l,v){for(var T=l.length;T--;)if(as(l[T][0],v))return T;return-1}function Qa(l,v,T){var G=v(l);return Oi(l)?G:de(G,T(l))}function si(l){return l==null?l===void 0?U:M:ct&&ct in Object(l)?ao(l):fo(l)}function is(l){return ni(l)&&si(l)==c}function rs(l,v,T,G,Ie){return l===v?!0:l==null||v==null||!ni(l)&&!ni(v)?l!==l&&v!==v:eo(l,v,T,G,rs,Ie)}function eo(l,v,T,G,Ie,se){var Te=Oi(l),Ye=Oi(v),Je=Te?h:Nt(l),Ae=Ye?h:Nt(v);Je=Je==c?_:Je,Ae=Ae==c?_:Ae;var ht=Je==_,yt=Ae==_,et=Je==Ae;if(et&&rr(l)){if(!rr(v))return!1;Te=!0,ht=!1}if(et&&!ht)return se||(se=new Pt),Te||us(l)?ss(l,v,T,G,Ie,se):so(l,v,Je,T,G,Ie,se);if(!(T&s)){var lt=ht&&te.call(l,"__wrapped__"),ft=yt&&te.call(v,"__wrapped__");if(lt||ft){var Tt=lt?l.value():l,xt=ft?v.value():v;return se||(se=new Pt),Ie(Tt,xt,T,G,se)}}return et?(se||(se=new Pt),no(l,v,T,G,Ie,se)):!1}function to(l){if(!hs(l)||uo(l))return!1;var v=os(l)?De:B;return v.test(Ht(l))}function io(l){return ni(l)&&cs(l.length)&&!!W[si(l)]}function ro(l){if(!lo(l))return Di(l);var v=[];for(var T in Object(l))te.call(l,T)&&T!="constructor"&&v.push(T);return v}function ss(l,v,T,G,Ie,se){var Te=T&s,Ye=l.length,Je=v.length;if(Ye!=Je&&!(Te&&Je>Ye))return!1;var Ae=se.get(l);if(Ae&&se.get(v))return Ae==v;var ht=-1,yt=!0,et=T&o?new Si:void 0;for(se.set(l,v),se.set(v,l);++ht<Ye;){var lt=l[ht],ft=v[ht];if(G)var Tt=Te?G(ft,lt,ht,v,l,se):G(lt,ft,ht,l,v,se);if(Tt!==void 0){if(Tt)continue;yt=!1;break}if(et){if(!me(v,function(xt,Bt){if(!ye(et,Bt)&&(lt===xt||Ie(lt,xt,T,G,se)))return et.push(Bt)})){yt=!1;break}}else if(!(lt===ft||Ie(lt,ft,T,G,se))){yt=!1;break}}return se.delete(l),se.delete(v),yt}function so(l,v,T,G,Ie,se,Te){switch(T){case J:if(l.byteLength!=v.byteLength||l.byteOffset!=v.byteOffset)return!1;l=l.buffer,v=v.buffer;case Y:return!(l.byteLength!=v.byteLength||!se(new gt(l),new gt(v)));case y:case x:case N:return as(+l,+v);case P:return l.name==v.name&&l.message==v.message;case w:case n:return l==v+"";case F:var Ye=fe;case b:var Je=G&s;if(Ye||(Ye=ce),l.size!=v.size&&!Je)return!1;var Ae=Te.get(l);if(Ae)return Ae==v;G|=o,Te.set(l,v);var ht=ss(Ye(l),Ye(v),G,Ie,se,Te);return Te.delete(l),ht;case f:if(je)return je.call(l)==je.call(v)}return!1}function no(l,v,T,G,Ie,se){var Te=T&s,Ye=ns(l),Je=Ye.length,Ae=ns(v),ht=Ae.length;if(Je!=ht&&!Te)return!1;for(var yt=Je;yt--;){var et=Ye[yt];if(!(Te?et in v:te.call(v,et)))return!1}var lt=se.get(l);if(lt&&se.get(v))return lt==v;var ft=!0;se.set(l,v),se.set(v,l);for(var Tt=Te;++yt<Je;){et=Ye[yt];var xt=l[et],Bt=v[et];if(G)var ls=Te?G(Bt,xt,et,v,l,se):G(xt,Bt,et,l,v,se);if(!(ls===void 0?xt===Bt||Ie(xt,Bt,T,G,se):ls)){ft=!1;break}Tt||(Tt=et=="constructor")}if(ft&&!Tt){var Ai=l.constructor,Ci=v.constructor;Ai!=Ci&&"constructor"in l&&"constructor"in v&&!(typeof Ai=="function"&&Ai instanceof Ai&&typeof Ci=="function"&&Ci instanceof Ci)&&(ft=!1)}return se.delete(l),se.delete(v),ft}function ns(l){return Qa(l,bo,oo)}function Ii(l,v){var T=l.__data__;return ho(v)?T[typeof v=="string"?"string":"hash"]:T.map}function Wt(l,v){var T=pe(l,v);return to(T)?T:void 0}function ao(l){var v=te.call(l,ct),T=l[ct];try{l[ct]=void 0;var G=!0}catch{}var Ie=_e.call(l);return G&&(v?l[ct]=T:delete l[ct]),Ie}var oo=jt?function(l){return l==null?[]:(l=Object(l),be(jt(l),function(v){return wt.call(l,v)}))}:wo,Nt=si;(Ue&&Nt(new Ue(new ArrayBuffer(1)))!=J||Pe&&Nt(new Pe)!=F||Le&&Nt(Le.resolve())!=S||Me&&Nt(new Me)!=b||$e&&Nt(new $e)!=z)&&(Nt=function(l){var v=si(l),T=v==_?l.constructor:void 0,G=T?Ht(T):"";if(G)switch(G){case Be:return J;case Ke:return F;case qe:return S;case Ve:return b;case Ge:return z}return v});function co(l,v){return v=v==null?u:v,!!v&&(typeof l=="number"||Q.test(l))&&l>-1&&l%1==0&&l<v}function ho(l){var v=typeof l;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?l!=="__proto__":l===null}function uo(l){return!!we&&we in l}function lo(l){var v=l&&l.constructor,T=typeof v=="function"&&v.prototype||ee;return l===T}function fo(l){return _e.call(l)}function Ht(l){if(l!=null){try{return ge.call(l)}catch{}try{return l+""}catch{}}return""}function as(l,v){return l===v||l!==l&&v!==v}var po=is(function(){return arguments}())?is:function(l){return ni(l)&&te.call(l,"callee")&&!wt.call(l,"callee")},Oi=Array.isArray;function go(l){return l!=null&&cs(l.length)&&!os(l)}var rr=ri||_o;function yo(l,v){return rs(l,v)}function os(l){if(!hs(l))return!1;var v=si(l);return v==E||v==D||v==p||v==d}function cs(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=u}function hs(l){var v=typeof l;return l!=null&&(v=="object"||v=="function")}function ni(l){return l!=null&&typeof l=="object"}var us=le?Ce(le):io;function bo(l){return go(l)?Za(l):ro(l)}function wo(){return[]}function _o(){return!1}i.exports=yo})(Ar,Ar.exports);var vf=Ar.exports;function Ef(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),u=o.charCodeAt(0);if(t[u]!==255)throw new TypeError(o+" is ambiguous");t[u]=s}var c=i.length,h=i.charAt(0),p=Math.log(c)/Math.log(256),y=Math.log(256)/Math.log(c);function x(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var F=0,N=0,M=0,_=D.length;M!==_&&D[M]===0;)M++,F++;for(var S=(_-M)*y+1>>>0,d=new Uint8Array(S);M!==_;){for(var w=D[M],b=0,n=S-1;(w!==0||b<N)&&n!==-1;n--,b++)w+=256*d[n]>>>0,d[n]=w%c>>>0,w=w/c>>>0;if(w!==0)throw new Error("Non-zero carry");N=b,M++}for(var f=S-N;f!==S&&d[f]===0;)f++;for(var U=h.repeat(F);f<S;++f)U+=i.charAt(d[f]);return U}function P(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var F=0;if(D[F]!==" "){for(var N=0,M=0;D[F]===h;)N++,F++;for(var _=(D.length-F)*p+1>>>0,S=new Uint8Array(_);D[F];){var d=t[D.charCodeAt(F)];if(d===255)return;for(var w=0,b=_-1;(d!==0||w<M)&&b!==-1;b--,w++)d+=c*S[b]>>>0,S[b]=d%256>>>0,d=d/256>>>0;if(d!==0)throw new Error("Non-zero carry");M=w,F++}if(D[F]!==" "){for(var n=_-M;n!==_&&S[n]===0;)n++;for(var f=new Uint8Array(N+(_-n)),U=N;n!==_;)f[U++]=S[n++];return f}}}function E(D){var F=P(D);if(F)return F;throw new Error(`Non-${e} character`)}return{encode:x,decodeUnsafe:P,decode:E}}var Df=Ef,Sf=Df;const ba=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},xf=i=>new TextEncoder().encode(i),If=i=>new TextDecoder().decode(i);class Of{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Af{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wa(this,e)}}class Cf{constructor(e){this.decoders=e}or(e){return wa(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const wa=(i,e)=>new Cf(Ee(Ee({},i.decoders||{[i.prefix]:i}),e.decoders||{[e.prefix]:e}));class Pf{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Of(e,t,r),this.decoder=new Af(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const tr=({name:i,prefix:e,encode:t,decode:r})=>new Pf(i,e,t,r),Ei=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=Sf(t,e);return tr({prefix:i,name:e,encode:r,decode:o=>ba(s(o))})},Nf=(i,e,t,r)=>{const s={};for(let y=0;y<e.length;++y)s[e[y]]=y;let o=i.length;for(;i[o-1]==="=";)--o;const u=new Uint8Array(o*t/8|0);let c=0,h=0,p=0;for(let y=0;y<o;++y){const x=s[i[y]];if(x===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|x,c+=t,c>=8&&(c-=8,u[p++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},Tf=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",u=0,c=0;for(let h=0;h<i.length;++h)for(c=c<<8|i[h],u+=8;u>t;)u-=t,o+=e[s&c>>u];if(u&&(o+=e[s&c<<t-u]),r)for(;o.length*t&7;)o+="=";return o},Qe=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>tr({prefix:e,name:i,encode(s){return Tf(s,r,t)},decode(s){return Nf(s,r,t,i)}}),Rf=tr({prefix:"\0",name:"identity",encode:i=>If(i),decode:i=>xf(i)});var Ff=Object.freeze({__proto__:null,identity:Rf});const Uf=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Lf=Object.freeze({__proto__:null,base2:Uf});const Mf=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var $f=Object.freeze({__proto__:null,base8:Mf});const jf=Ei({prefix:"9",name:"base10",alphabet:"0123456789"});var zf=Object.freeze({__proto__:null,base10:jf});const Hf=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Bf=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Kf=Object.freeze({__proto__:null,base16:Hf,base16upper:Bf});const qf=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Vf=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Gf=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kf=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Wf=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Yf=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Jf=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xf=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zf=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Qf=Object.freeze({__proto__:null,base32:qf,base32upper:Vf,base32pad:Gf,base32padupper:kf,base32hex:Wf,base32hexupper:Yf,base32hexpad:Jf,base32hexpadupper:Xf,base32z:Zf});const ed=Ei({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),td=Ei({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var id=Object.freeze({__proto__:null,base36:ed,base36upper:td});const rd=Ei({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),sd=Ei({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var nd=Object.freeze({__proto__:null,base58btc:rd,base58flickr:sd});const ad=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),od=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),cd=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hd=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ud=Object.freeze({__proto__:null,base64:ad,base64pad:od,base64url:cd,base64urlpad:hd});const _a=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ld=_a.reduce((i,e,t)=>(i[t]=e,i),[]),fd=_a.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function dd(i){return i.reduce((e,t)=>(e+=ld[t],e),"")}function pd(i){const e=[];for(const t of i){const r=fd[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const gd=tr({prefix:"\u{1F680}",name:"base256emoji",encode:dd,decode:pd});var yd=Object.freeze({__proto__:null,base256emoji:gd}),bd=ma,qs=128,wd=127,_d=~wd,md=Math.pow(2,31);function ma(i,e,t){e=e||[],t=t||0;for(var r=t;i>=md;)e[t++]=i&255|qs,i/=128;for(;i&_d;)e[t++]=i&255|qs,i>>>=7;return e[t]=i|0,ma.bytes=t-r+1,e}var vd=Cr,Ed=128,Vs=127;function Cr(i,r){var t=0,r=r||0,s=0,o=r,u,c=i.length;do{if(o>=c)throw Cr.bytes=0,new RangeError("Could not decode varint");u=i[o++],t+=s<28?(u&Vs)<<s:(u&Vs)*Math.pow(2,s),s+=7}while(u>=Ed);return Cr.bytes=o-r,t}var Dd=Math.pow(2,7),Sd=Math.pow(2,14),xd=Math.pow(2,21),Id=Math.pow(2,28),Od=Math.pow(2,35),Ad=Math.pow(2,42),Cd=Math.pow(2,49),Pd=Math.pow(2,56),Nd=Math.pow(2,63),Td=function(i){return i<Dd?1:i<Sd?2:i<xd?3:i<Id?4:i<Od?5:i<Ad?6:i<Cd?7:i<Pd?8:i<Nd?9:10},Rd={encode:bd,decode:vd,encodingLength:Td},va=Rd;const Gs=(i,e,t=0)=>(va.encode(i,e,t),e),ks=i=>va.encodingLength(i),Pr=(i,e)=>{const t=e.byteLength,r=ks(i),s=r+ks(t),o=new Uint8Array(s+t);return Gs(i,o,0),Gs(t,o,r),o.set(e,s),new Fd(i,t,e,o)};class Fd{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const Ea=({name:i,code:e,encode:t})=>new Ud(i,e,t);class Ud{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Pr(this.code,t):t.then(r=>Pr(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Da=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Ld=Ea({name:"sha2-256",code:18,encode:Da("SHA-256")}),Md=Ea({name:"sha2-512",code:19,encode:Da("SHA-512")});var $d=Object.freeze({__proto__:null,sha256:Ld,sha512:Md});const Sa=0,jd="identity",xa=ba,zd=i=>Pr(Sa,xa(i)),Hd={code:Sa,name:jd,encode:xa,digest:zd};var Bd=Object.freeze({__proto__:null,identity:Hd});new TextEncoder,new TextDecoder;const Ws=Ee(Ee(Ee(Ee(Ee(Ee(Ee(Ee(Ee(Ee({},Ff),Lf),$f),zf),Kf),Qf),id),nd),ud),yd);Ee(Ee({},$d),Bd);function Kd(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function Ia(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const Ys=Ia("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),cr=Ia("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Kd(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),qd=Ee({utf8:Ys,"utf-8":Ys,hex:Ws.base16,latin1:cr,ascii:cr,binary:cr},Ws);function Vd(i,e="utf8"){const t=qd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}const Oa="wc",Gd=2,Xr="core",Lt=`${Oa}@${2}:${Xr}:`,kd={name:Xr,logger:"error"},Wd={database:":memory:"},Yd="crypto",Js="client_ed25519_seed",Jd=Z.ONE_DAY,Xd="keychain",Zd="0.3",Qd="messages",ep="0.3",tp=Z.SIX_HOURS,ip="publisher",Aa="irn",rp="error",sp="wss://relay.walletconnect.com",np="relayer",it={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ap="_subscription",Ni={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Xs=Z.ONE_SECOND,op="2.3.3",cp="0.3",vt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},hp="subscription",up="0.3",lp=Z.FIVE_SECONDS*1e3,fp="pairing",dp="0.3",ai={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},mt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},pp="history",gp="0.3",yp="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},bp="0.3";class wp{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Xd,this.version=Zd,this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}},this.has=r=>(this.isInitialized(),this.keychain.has(r)),this.set=async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()},this.get=r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:o}=q("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s},this.del=async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()},this.core=e,this.logger=xe.generateChildLogger(t,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ua(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?la(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}class _p{constructor(e,t,r){this.core=e,this.logger=t,this.name=Yd,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=xs(s);return Qn(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=ul();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),u=xs(o),c=Sr();return await Ru(c,s,Jd,u)},this.generateSharedKey=(s,o,u)=>{this.isInitialized();const c=this.getPrivateKey(s),h=ll(c,o);return this.setSymKey(h,u)},this.setSymKey=async(s,o)=>{this.isInitialized();const u=o||fl(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,u)=>{this.isInitialized();const c=ca(u),h=Tr(o);if(Fs(c)){const P=c.senderPublicKey,E=c.receiverPublicKey;s=await this.generateSharedKey(P,E)}const p=this.getSymKey(s),{type:y,senderPublicKey:x}=c;return pl({type:y,symKey:p,message:h,senderPublicKey:x})},this.decode=async(s,o,u)=>{this.isInitialized();const c=bl(o,u);if(Fs(c)){const y=c.receiverPublicKey,x=c.senderPublicKey;s=await this.generateSharedKey(y,x)}const h=this.getSymKey(s),p=gl({symKey:h,encoded:o});return bn(p)},this.core=e,this.logger=xe.generateChildLogger(t,this.name),this.keychain=r||new wp(this.core,this.logger)}get context(){return xe.getLoggerContext(this.logger)}getPayloadType(e){const t=Wr(e);return _i(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Js)}catch{e=Sr(),await this.keychain.set(Js,e)}return Vd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}class mp extends wc{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Qd,this.version=ep,this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}},this.set=async(r,s)=>{this.isInitialized();const o=xr(s);let u=this.messages.get(r);return typeof u>"u"&&(u={}),typeof u[o]<"u"||(u[o]=s,this.messages.set(r,u),await this.persist()),o},this.get=r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s},this.has=(r,s)=>{this.isInitialized();const o=this.get(r),u=xr(s);return typeof o[u]<"u"},this.del=async r=>{this.isInitialized(),this.messages.delete(r),await this.persist()},this.logger=xe.generateChildLogger(e,this.name),this.core=t}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ua(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?la(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}class vp extends _c{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new At.exports.EventEmitter,this.name=ip,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(r,s,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}});try{const u=(o==null?void 0:o.ttl)||tp,c=Ir(o),h=(o==null?void 0:o.prompt)||!1,p=(o==null?void 0:o.tag)||0,y={topic:r,message:s,opts:{ttl:u,relay:c,prompt:h,tag:p}},x=xr(s);this.queue.set(x,y);try{await await fa(this.rpcPublish(r,s,u,c,h,p),this.publishTimeout),this.relayer.events.emit(it.publish,y)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(it.connection_stalled);return}this.onPublish(x,y),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.relayer=e,this.logger=xe.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return xe.getLoggerContext(this.logger)}rpcPublish(e,t,r,s,o,u){var c,h,p,y;const x={method:Or(s.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:o,tag:u}};return pt((c=x.params)==null?void 0:c.prompt)&&((h=x.params)==null||delete h.prompt),pt((p=x.params)==null?void 0:p.tag)&&((y=x.params)==null||delete y.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:x}),this.relayer.provider.request(x)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:r,opts:s}=e;await this.publish(t,r,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(gi.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Ep{constructor(){this.map=new Map,this.set=(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const s=r.filter(o=>o!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Dp=Object.defineProperty,Sp=Object.defineProperties,xp=Object.getOwnPropertyDescriptors,Zs=Object.getOwnPropertySymbols,Ip=Object.prototype.hasOwnProperty,Op=Object.prototype.propertyIsEnumerable,Qs=(i,e,t)=>e in i?Dp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ti=(i,e)=>{for(var t in e||(e={}))Ip.call(e,t)&&Qs(i,t,e[t]);if(Zs)for(var t of Zs(e))Op.call(e,t)&&Qs(i,t,e[t]);return i},hr=(i,e)=>Sp(i,xp(e));class Ap extends Ec{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Ep,this.events=new At.exports.EventEmitter,this.name=hp,this.version=up,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Lt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(r,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const o=Ir(s),u={topic:r,relay:o};this.pending.set(r,u);const c=await this.rpcSubscribe(r,o);return this.onSubscribe(c,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(r,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)},this.isSubscribed=async r=>this.topics.includes(r)?!0:await new Promise((s,o)=>{const u=new Z.Watch;u.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(r)&&this.topics.includes(r)&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=lp&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),o(!1))},this.pendingSubInterval)}),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=xe.generateChildLogger(t,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=Ir(r);await this.rpcUnsubscribe(e,t,s);const o=He("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const r={method:Or(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let s;try{s=await await fa(this.relayer.provider.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(it.connection_stalled)}return s}rpcUnsubscribe(e,t,r){const s={method:Or(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,hr(Ti({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,hr(Ti({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Ti({},t)),this.topicMap.set(t.topic,e),this.events.emit(vt.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(vt.deleted,hr(Ti({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(vt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(vt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:r}=e,s={topic:t,relay:r};this.pending.set(s.topic,s);const o=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(o,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(gi.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(it.connect,async()=>{await this.onConnect()}),this.relayer.on(it.disconnect,()=>{this.onDisconnect()}),this.events.on(vt.created,async e=>{const t=vt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(vt.deleted,async e=>{const t=vt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Cp=Object.defineProperty,en=Object.getOwnPropertySymbols,Pp=Object.prototype.hasOwnProperty,Np=Object.prototype.propertyIsEnumerable,tn=(i,e,t)=>e in i?Cp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Tp=(i,e)=>{for(var t in e||(e={}))Pp.call(e,t)&&tn(i,t,e[t]);if(en)for(var t of en(e))Np.call(e,t)&&tn(i,t,e[t]);return i};class Rp extends mc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new At.exports.EventEmitter,this.name=np,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?xe.generateChildLogger(e.logger,this.name):di(xe.getDefaultLoggerOptions({level:e.logger||rp})),this.messages=new mp(this.logger,e.core),this.subscriber=new Ap(this,this.logger),this.publisher=new vp(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||sp,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return xe.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){this.isInitialized();let r="";return await Promise.all([new Promise(s=>{this.subscriber.once(vt.created,o=>{o.topic===e&&s()})}),new Promise(async s=>{r=await this.subscriber.subscribe(e,t),s()})]),r}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(it.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(vt.resubscribed,()=>{t()})}),await Promise.race([this.provider.connect(),new Promise((t,r)=>this.once(it.transport_closed,()=>{r(new Error("closeTransport called before connection was established"))}))])])}catch(t){const r=t;if(!/socket hang up/i.test(r.message))throw new Error(r.message);this.logger.error(r),this.events.emit(it.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(t=>setTimeout(t,Xs)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new fi(new mf(Nl({sdkVersion:op,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:r}=e;await this.messages.set(t,r)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,r):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Fr(e)){if(!e.method.endsWith(ap))return;const t=e.params,{topic:r,message:s}=t.data,o={topic:r,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Tp({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(it.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Ur(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Ni.payload,e=>this.onProviderPayload(e)),this.provider.on(Ni.connect,()=>{this.events.emit(it.connect)}),this.provider.on(Ni.disconnect,()=>{this.events.emit(it.disconnect),this.attemptToReconnect()}),this.provider.on(Ni.error,e=>this.events.emit(it.error,e)),this.events.on(it.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Z.toMiliseconds(Xs))}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Fp=Object.defineProperty,rn=Object.getOwnPropertySymbols,Up=Object.prototype.hasOwnProperty,Lp=Object.prototype.propertyIsEnumerable,sn=(i,e,t)=>e in i?Fp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,nn=(i,e)=>{for(var t in e||(e={}))Up.call(e,t)&&sn(i,t,e[t]);if(rn)for(var t of rn(e))Lp.call(e,t)&&sn(i,t,e[t]);return i};class ir extends vc{constructor(e,t,r,s=Lt,o=void 0){super(e,t,r,s),this.core=e,this.logger=t,this.name=r,this.map=new Map,this.version=cp,this.cached=[],this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{Zl(u)?this.map.set(u.id,u):Ql(u)?this.map.set(u.topic,u):this.getKey&&u!==null&&!pt(u)&&this.map.set(this.getKey(u),u)}),this.cached=[],this.initialized=!0)},this.set=async(u,c)=>{this.isInitialized(),this.map.has(u)?await this.update(u,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:c}),this.map.set(u,c),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(c=>Object.keys(u).every(h=>vf(c[h],u[h]))):this.values),this.update=async(u,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:c});const h=nn(nn({},this.getData(u)),c);this.map.set(u,h),await this.persist()},this.delete=async(u,c)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:c}),this.map.delete(u),await this.persist())},this.logger=xe.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:r}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Mp{constructor(e,t){this.core=e,this.logger=t,this.name=fp,this.version=dp,this.events=new Nr,this.initialized=!1,this.storagePrefix=Lt,this.ignoredPayloadTypes=[kt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]},this.create=async()=>{this.isInitialized();const r=Sr(),s=await this.core.crypto.setSymKey(r),o=Et(Z.FIVE_MINUTES),u={protocol:Aa},c={topic:s,expiry:o,relay:u,active:!1},h=Bl({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:r,relay:u});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:h}},this.pair=async r=>{this.isInitialized(),this.isValidPair(r);const{topic:s,symKey:o,relay:u}=zl(r.uri),c=Et(Z.FIVE_MINUTES),h={topic:s,relay:u,expiry:c,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,c),r.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:r})=>{this.isInitialized();const s=Et(Z.THIRTY_DAYS);await this.pairings.update(r,{active:!0,expiry:s}),this.core.expirer.set(r,s)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:c,reject:h}=Kt();this.events.once(Fe("pairing_ping",o),({error:p})=>{p?h(p):c()}),await u()}},this.updateExpiry=async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})},this.updateMetadata=async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",He("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(r,s,o)=>{const u=Lr(s,o),c=await this.core.crypto.encode(r,u),h=ai[s].req;return this.core.history.set(r,u),await this.core.relayer.publish(r,c,h),u.id},this.sendResult=async(r,s,o)=>{const u=Ur(r,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,r),p=ai[h.request.method].res;await this.core.relayer.publish(s,c,p),await this.core.history.resolve(u)},this.sendError=async(r,s,o)=>{const u=Rr(r,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,r),p=ai[h.request.method]?ai[h.request.method].res:ai.unregistered_method.res;await this.core.relayer.publish(s,c,p),await this.core.history.resolve(u)},this.deletePairing=async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,He("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])},this.cleanup=async()=>{const r=this.pairings.getAll().filter(s=>Ft(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=r=>{const{topic:s,payload:o}=r,u=o.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,u=(await this.core.history.get(s,o.id)).request.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.events.emit("pairing_ping",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.logger.error(u)}},this.onPairingPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{Rt(s)?this.events.emit(Fe("pairing_ping",o),{}):Ot(s)&&this.events.emit(Fe("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r}),await this.sendResult(o,r,!0),await this.deletePairing(r),this.events.emit("pairing_delete",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(r,s)=>{const{id:o,method:u}=s;try{if(this.registeredMethods.includes(u))return;const c=He("WC_METHOD_UNSUPPORTED",u);await this.sendError(o,r,c),this.logger.error(c)}catch(c){await this.sendError(o,r,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=r=>{this.registeredMethods.includes(r)||this.logger.error(He("WC_METHOD_UNSUPPORTED",r))},this.isValidPair=r=>{if(!rt(r)){const{message:s}=q("MISSING_OR_INVALID",`pair() params: ${r}`);throw new Error(s)}if(!Xl(r.uri)){const{message:s}=q("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw new Error(s)}},this.isValidPing=async r=>{if(!rt(r)){const{message:o}=q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidDisconnect=async r=>{if(!rt(r)){const{message:o}=q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async r=>{if(!Xe(r,!1)){const{message:s}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(Ft(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=q("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}},this.core=e,this.logger=xe.generateChildLogger(t,this.name),this.pairings=new ir(this.core,this.logger,this.name,this.storagePrefix)}get context(){return xe.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(it.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const s=await this.core.crypto.decode(t,r);Fr(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):wn(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async e=>{const{topic:t}=pa(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class $p extends bc{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new At.exports.EventEmitter,this.name=pp,this.version=gp,this.cached=[],this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(r,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:o}),this.records.has(s.id))return;const u={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:o};this.records.set(u.id,u),this.events.emit(mt.created,u)},this.resolve=async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=Ot(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.events.emit(mt.updated,s))},this.get=async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s)),this.delete=(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===r){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(mt.deleted,o)}})},this.exists=async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=xe.generateChildLogger(t,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:Lr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(mt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(mt.created,e=>{const t=mt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(mt.updated,e=>{const t=mt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(mt.deleted,e=>{const t=mt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}class jp extends Dc{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new At.exports.EventEmitter,this.name=yp,this.version=bp,this.cached=[],this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(r,s)=>{this.isInitialized();const o=this.formatTarget(r),u={target:o,expiry:s};this.expirations.set(o,u),this.checkExpiry(o,u),this.events.emit(dt.created,{target:o,expiration:u})},this.get=r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)},this.del=r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(dt.deleted,{target:s,expiration:o})}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=xe.generateChildLogger(t,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Tl(e);if(typeof e=="number")return Rl(e);const{message:t}=q("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;Z.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(dt.expired,{target:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(gi.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(dt.created,e=>{const t=dt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(dt.expired,e=>{const t=dt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(dt.deleted,e=>{const t=dt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zp=Object.defineProperty,an=Object.getOwnPropertySymbols,Hp=Object.prototype.hasOwnProperty,Bp=Object.prototype.propertyIsEnumerable,on=(i,e,t)=>e in i?zp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,cn=(i,e)=>{for(var t in e||(e={}))Hp.call(e,t)&&on(i,t,e[t]);if(an)for(var t of an(e))Bp.call(e,t)&&on(i,t,e[t]);return i};class Zr extends yc{constructor(e){super(e),this.protocol=Oa,this.version=Gd,this.name=Xr,this.events=new At.exports.EventEmitter,this.initialized=!1,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.projectId=e==null?void 0:e.projectId;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:di(xe.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||kd.logger}));this.logger=xe.generateChildLogger(t,this.name),this.heartbeat=new gi.HeartBeat,this.crypto=new _p(this,this.logger,e==null?void 0:e.keychain),this.history=new $p(this,this.logger),this.expirer=new jp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new tc(cn(cn({},Wd),e==null?void 0:e.storageOptions)),this.relayer=new Rp({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new Mp(this,this.logger)}static async init(e){const t=new Zr(e);return await t.initialize(),t}get context(){return xe.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Kp=Zr,Ca="wc",Pa=2,Na="client",Qr=`${Ca}@${Pa}:${Na}:`,ur={name:Na,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},qp="proposal",Vp="session",Ri=Z.SEVEN_DAYS,Gp="engine",oi={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},lr={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},kp="request";var Wp=Object.defineProperty,Yp=Object.defineProperties,Jp=Object.getOwnPropertyDescriptors,hn=Object.getOwnPropertySymbols,Xp=Object.prototype.hasOwnProperty,Zp=Object.prototype.propertyIsEnumerable,un=(i,e,t)=>e in i?Wp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,It=(i,e)=>{for(var t in e||(e={}))Xp.call(e,t)&&un(i,t,e[t]);if(hn)for(var t of hn(e))Zp.call(e,t)&&un(i,t,e[t]);return i},fr=(i,e)=>Yp(i,Jp(e));class Qp extends xc{constructor(e){super(e),this.name=Gp,this.events=new Nr,this.initialized=!1,this.ignoredPayloadTypes=[kt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(oi)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized(),await this.isValidConnect(t);const{pairingTopic:r,requiredNamespaces:s,relays:o}=t;let u=r,c,h=!1;if(u&&(h=this.client.core.pairing.pairings.get(u).active),!u||!h){const{topic:N,uri:M}=await this.client.core.pairing.create();u=N,c=M}const p=await this.client.core.crypto.generateKeyPair(),y={requiredNamespaces:s,relays:o!=null?o:[{protocol:Aa}],proposer:{publicKey:p,metadata:this.client.metadata}},{reject:x,resolve:P,done:E}=Kt();if(this.events.once(Fe("session_connect"),async({error:N,session:M})=>{if(N)x(N);else if(M){M.self.publicKey=p;const _=fr(It({},M),{requiredNamespaces:M.requiredNamespaces});await this.client.session.set(M.topic,_),await this.setExpiry(M.topic,M.expiry),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:M.peer.metadata}),P(_)}}),!u){const{message:N}=q("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(N)}const D=await this.sendRequest(u,"wc_sessionPropose",y),F=Et(Z.FIVE_MINUTES);return await this.setProposal(D,It({id:D,expiry:F},y)),{uri:c,approval:E}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:r,relayProtocol:s,namespaces:o}=t,u=this.client.proposal.get(r);let{pairingTopic:c,proposer:h,requiredNamespaces:p}=u;ji(p)||(p=Gl(o,"approve()"),this.client.proposal.set(r,fr(It({},u),{requiredNamespaces:p})));const y=await this.client.core.crypto.generateKeyPair(),x=h.publicKey,P=await this.client.core.crypto.generateSharedKey(y,x),E={relay:{protocol:s!=null?s:"irn"},namespaces:o,requiredNamespaces:p,controller:{publicKey:y,metadata:this.client.metadata},expiry:Et(Ri)};await this.client.core.relayer.subscribe(P);const D=await this.sendRequest(P,"wc_sessionSettle",E),{done:F,resolve:N,reject:M}=Kt();this.events.once(Fe("session_approve",D),({error:S})=>{S?M(S):N(this.client.session.get(P))});const _=fr(It({},E),{topic:P,acknowledged:!1,self:E.controller,peer:{publicKey:h.publicKey,metadata:h.metadata},controller:y});return await this.client.session.set(P,_),await this.setExpiry(P,Et(Ri)),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:_.peer.metadata}),c&&r&&(await this.sendResult(r,c,{relay:{protocol:s!=null?s:"irn"},responderPublicKey:y}),await this.client.proposal.delete(r,He("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:c})),{topic:P,acknowledged:F}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:r,reason:s}=t,{pairingTopic:o}=this.client.proposal.get(r);o&&(await this.sendError(r,o,s),await this.client.proposal.delete(r,He("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:r,namespaces:s}=t,o=await this.sendRequest(r,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:c,reject:h}=Kt();return this.events.once(Fe("session_update",o),({error:p})=>{p?h(p):c()}),await this.client.session.update(r,{namespaces:s}),{acknowledged:u}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:r}=t,s=await this.sendRequest(r,"wc_sessionExtend",{}),{done:o,resolve:u,reject:c}=Kt();return this.events.once(Fe("session_extend",s),({error:h})=>{h?c(h):u()}),await this.setExpiry(r,Et(Ri)),{acknowledged:o}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:r,request:s,topic:o,expiry:u}=t,c=await this.sendRequest(o,"wc_sessionRequest",{request:s,chainId:r},u),{done:h,resolve:p,reject:y}=Kt(u);return this.events.once(Fe("session_request",c),({error:x,result:P})=>{x?y(x):p(P)}),await h()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:r,response:s}=t,{id:o}=s;Rt(s)?await this.sendResult(o,r,s.result):Ot(s)&&await this.sendError(o,r,s.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:r}=t;if(this.client.session.keys.includes(r)){const s=await this.sendRequest(r,"wc_sessionPing",{}),{done:o,resolve:u,reject:c}=Kt();this.events.once(Fe("session_ping",s),({error:h})=>{h?c(h):u()}),await o()}else this.client.core.pairing.pairings.keys.includes(r)&&await this.client.core.pairing.ping({topic:r})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:r,event:s,chainId:o}=t;await this.sendRequest(r,"wc_sessionEvent",{event:s,chainId:o})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:r}=t;this.client.session.keys.includes(r)?(await this.sendRequest(r,"wc_sessionDelete",He("USER_DISCONNECTED")),await this.deleteSession(r)):await this.client.core.pairing.disconnect({topic:r})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(r=>Yl(r,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,r)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,He("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(t),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,r)=>{await Promise.all([this.client.proposal.delete(t,He("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,r,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,r),s?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,r)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:r}),this.client.core.expirer.set(t,r)},this.setProposal=async(t,r)=>{await this.client.proposal.set(t,r),this.client.core.expirer.set(t,r.expiry)},this.setPendingSessionRequest=async t=>{const r=oi.wc_sessionRequest.req.ttl,{id:s,topic:o,params:u}=t;await this.client.pendingRequest.set(s,{id:s,topic:o,params:u}),r&&this.client.core.expirer.set(s,Et(r))},this.sendRequest=async(t,r,s,o)=>{const u=Lr(r,s),c=await this.client.core.crypto.encode(t,u),h=oi[r].req;return o&&(h.ttl=o),this.client.core.history.set(t,u),this.client.core.relayer.publish(t,c,h),u.id},this.sendResult=async(t,r,s)=>{const o=Ur(t,s),u=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),h=oi[c.request.method].res;this.client.core.relayer.publish(r,u,h),await this.client.core.history.resolve(o)},this.sendError=async(t,r,s)=>{const o=Rr(t,s),u=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),h=oi[c.request.method].res;this.client.core.relayer.publish(r,u,h),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const t=[],r=[];this.client.session.getAll().forEach(s=>{Ft(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ft(s.expiry)&&r.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...r.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=t=>{const{topic:r,payload:s}=t,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(r,s);case"wc_sessionSettle":return this.onSessionSettleRequest(r,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(r,s);case"wc_sessionExtend":return this.onSessionExtendRequest(r,s);case"wc_sessionPing":return this.onSessionPingRequest(r,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(r,s);case"wc_sessionRequest":return this.onSessionRequest(r,s);case"wc_sessionEvent":return this.onSessionEventRequest(r,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async t=>{const{topic:r,payload:s}=t,o=(await this.client.core.history.get(r,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,s);case"wc_sessionExtend":return this.onSessionExtendResponse(r,s);case"wc_sessionPing":return this.onSessionPingResponse(r,s);case"wc_sessionRequest":return this.onSessionRequestResponse(r,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onSessionProposeRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidConnect(It({},r.params));const u=Et(Z.FIVE_MINUTES),c=It({id:o,pairingTopic:t,expiry:u},s);await this.setProposal(o,c),this.client.events.emit("session_proposal",{id:o,params:c})}catch(u){await this.sendError(o,t,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(t,r)=>{const{id:s}=r;if(Rt(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const c=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const p=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p});const y=await this.client.core.relayer.subscribe(p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:y}),await this.client.core.pairing.activate({topic:t})}else Ot(r)&&(await this.client.proposal.delete(s,He("USER_DISCONNECTED")),this.events.emit(Fe("session_connect"),{error:r.error}))},this.onSessionSettleRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidSessionSettleRequest(o);const{relay:u,controller:c,expiry:h,namespaces:p,requiredNamespaces:y}=r.params,x={topic:t,relay:u,expiry:h,namespaces:p,acknowledged:!0,requiredNamespaces:y,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}};await this.sendResult(r.id,t,!0),this.events.emit(Fe("session_connect"),{session:x})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(t,r)=>{const{id:s}=r;Rt(r)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Fe("session_approve",s),{})):Ot(r)&&(await this.client.session.delete(t,He("USER_DISCONNECTED")),this.events.emit(Fe("session_approve",s),{error:r.error}))},this.onSessionUpdateRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidUpdate(It({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult(o,t,!0),this.client.events.emit("session_update",{id:o,topic:t,params:s})}catch(u){await this.sendError(o,t,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(t,r)=>{const{id:s}=r;Rt(r)?this.events.emit(Fe("session_update",s),{}):Ot(r)&&this.events.emit(Fe("session_update",s),{error:r.error})},this.onSessionExtendRequest=async(t,r)=>{const{id:s}=r;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Et(Ri)),await this.sendResult(s,t,!0),this.client.events.emit("session_extend",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(t,r)=>{const{id:s}=r;Rt(r)?this.events.emit(Fe("session_extend",s),{}):Ot(r)&&this.events.emit(Fe("session_extend",s),{error:r.error})},this.onSessionPingRequest=async(t,r)=>{const{id:s}=r;try{this.isValidPing({topic:t}),await this.sendResult(s,t,!0),this.client.events.emit("session_ping",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionPingResponse=(t,r)=>{const{id:s}=r;setTimeout(()=>{Rt(r)?this.events.emit(Fe("session_ping",s),{}):Ot(r)&&this.events.emit(Fe("session_ping",s),{error:r.error})},500)},this.onSessionDeleteRequest=async(t,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:t,reason:r.params}),this.client.core.relayer.once(it.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(s,t,!0),this.client.events.emit("session_delete",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidRequest(It({topic:t},o)),await this.setPendingSessionRequest({id:s,topic:t,params:o}),this.client.events.emit("session_request",{id:s,topic:t,params:o})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(t,r)=>{const{id:s}=r;Rt(r)?this.events.emit(Fe("session_request",s),{result:r.result}):Ot(r)&&this.events.emit(Fe("session_request",s),{error:r.error})},this.onSessionEventRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidEmit(It({topic:t},o)),this.client.events.emit("session_event",{id:s,topic:t,params:o})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.isValidConnect=async t=>{if(!rt(t)){const{message:c}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(c)}const{pairingTopic:r,requiredNamespaces:s,relays:o}=t;if(pt(r)||await this.isValidPairingTopic(r),!pt(s)&&ji(s)===0)return;const u=of(s,"connect()");if(u)throw new Error(u.message);if(!cf(o,!0)){const{message:c}=q("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(c)}},this.isValidApprove=async t=>{if(!rt(t))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:r,namespaces:s,relayProtocol:o}=t;await this.isValidProposalId(r);const u=this.client.proposal.get(r),c=Ui(s,"approve()");if(c)throw new Error(c.message);const h=Bs(u.requiredNamespaces,s,"update()");if(h)throw new Error(h.message);if(!Xe(o,!0)){const{message:p}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(p)}},this.isValidReject=async t=>{if(!rt(t)){const{message:o}=q("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(o)}const{id:r,reason:s}=t;if(await this.isValidProposalId(r),!uf(s)){const{message:o}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=t=>{if(!rt(t)){const{message:p}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(p)}const{relay:r,controller:s,namespaces:o,expiry:u}=t;if(!ya(r)){const{message:p}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(p)}const c=ef(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=Ui(o,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Ft(u)){const{message:p}=q("EXPIRED","onSessionSettleRequest()");throw new Error(p)}},this.isValidUpdate=async t=>{if(!rt(t)){const{message:h}=q("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(h)}const{topic:r,namespaces:s}=t;await this.isValidSessionTopic(r);const o=this.client.session.get(r),u=Ui(s,"update()");if(u)throw new Error(u.message);const c=Bs(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async t=>{if(!rt(t)){const{message:s}=q("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionTopic(r)},this.isValidRequest=async t=>{if(!rt(t)){const{message:h}=q("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(h)}const{topic:r,request:s,chainId:o,expiry:u}=t;await this.isValidSessionTopic(r);const{namespaces:c}=this.client.session.get(r);if(!Hs(c,o)){const{message:h}=q("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(h)}if(!lf(s)){const{message:h}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!pf(c,o,s.method)){const{message:h}=q("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(u&&!yf(u,lr)){const{message:h}=q("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${lr.min} and ${lr.max}`);throw new Error(h)}},this.isValidRespond=async t=>{if(!rt(t)){const{message:o}=q("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:r,response:s}=t;if(await this.isValidSessionTopic(r),!ff(s)){const{message:o}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async t=>{if(!rt(t)){const{message:s}=q("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.isValidEmit=async t=>{if(!rt(t)){const{message:c}=q("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(c)}const{topic:r,event:s,chainId:o}=t;await this.isValidSessionTopic(r);const{namespaces:u}=this.client.session.get(r);if(!Hs(u,o)){const{message:c}=q("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!df(s)){const{message:c}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!gf(u,o,s.name)){const{message:c}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async t=>{if(!rt(t)){const{message:s}=q("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(it.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(r)))return;const s=await this.client.core.crypto.decode(t,r);Fr(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):wn(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(dt.expired,async e=>{const{topic:t,id:r}=pa(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,q("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}isValidPairingTopic(e){if(!Xe(e,!1)){const{message:t}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ft(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=q("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Xe(e,!1)){const{message:t}=q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Ft(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=q("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Xe(e,!1)){const{message:t}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!hf(e)){const{message:t}=q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Ft(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=q("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class eg extends ir{constructor(e,t){super(e,t,qp,Qr),this.core=e,this.logger=t}}class tg extends ir{constructor(e,t){super(e,t,Vp,Qr),this.core=e,this.logger=t}}class ig extends ir{constructor(e,t){super(e,t,kp,Qr),this.core=e,this.logger=t}}class es extends Sc{constructor(e){super(e),this.protocol=Ca,this.version=Pa,this.name=ur.name,this.events=new At.exports.EventEmitter,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.removeAllListeners=r=>this.events.removeAllListeners(r),this.connect=async r=>{try{return await this.engine.connect(r)}catch(s){throw this.logger.error(s.message),s}},this.pair=async r=>{try{return await this.engine.pair(r)}catch(s){throw this.logger.error(s.message),s}},this.approve=async r=>{try{return await this.engine.approve(r)}catch(s){throw this.logger.error(s.message),s}},this.reject=async r=>{try{return await this.engine.reject(r)}catch(s){throw this.logger.error(s.message),s}},this.update=async r=>{try{return await this.engine.update(r)}catch(s){throw this.logger.error(s.message),s}},this.extend=async r=>{try{return await this.engine.extend(r)}catch(s){throw this.logger.error(s.message),s}},this.request=async r=>{try{return await this.engine.request(r)}catch(s){throw this.logger.error(s.message),s}},this.respond=async r=>{try{return await this.engine.respond(r)}catch(s){throw this.logger.error(s.message),s}},this.ping=async r=>{try{return await this.engine.ping(r)}catch(s){throw this.logger.error(s.message),s}},this.emit=async r=>{try{return await this.engine.emit(r)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async r=>{try{return await this.engine.disconnect(r)}catch(s){throw this.logger.error(s.message),s}},this.find=r=>{try{return this.engine.find(r)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}},this.name=(e==null?void 0:e.name)||ur.name,this.metadata=(e==null?void 0:e.metadata)||Ol();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:di(xe.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||ur.logger}));this.core=(e==null?void 0:e.core)||new Kp(e),this.logger=xe.generateChildLogger(t,this.name),this.session=new tg(this.core,this.logger),this.proposal=new eg(this.core,this.logger),this.pendingRequest=new ig(this.core,this.logger),this.engine=new Qp(this)}static async init(e){const t=new es(e);return await t.initialize(),t}get context(){return xe.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}function rg(i){var e;const t=(e=i[Object.keys(i)[0]])==null?void 0:e.chains[0];return[t.split(":")[0],t.split(":")[1]]}function Mt(i,e){let t;return e.rpcMap&&(t=e.rpcMap[sg([i])]),t}function sg(i){return Number(i[0].split(":")[1])}class ng{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const r=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";return this.setDefaultChain(parseInt(r,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const r=t||Mt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,t){const r=t||Mt(e,this.namespace);return typeof r>"u"?void 0:new fi(new zi(r))}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}}class ag{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Mt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Mt(e,this.namespace);return typeof r>"u"?void 0:new fi(new zi(r))}}class og{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Mt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Mt(e,this.namespace);return typeof r>"u"?void 0:new fi(new zi(r))}}class cg{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Mt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Mt(e,this.namespace);return typeof r>"u"?void 0:new fi(new zi(r))}}const ln="error",hg="wss://relay.walletconnect.com",ug="wc",lg="universal_provider",fn=`${ug}@${2}:${lg}:`;var fg=Object.defineProperty,dg=Object.defineProperties,pg=Object.getOwnPropertyDescriptors,dn=Object.getOwnPropertySymbols,gg=Object.prototype.hasOwnProperty,yg=Object.prototype.propertyIsEnumerable,pn=(i,e,t)=>e in i?fg(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,gn=(i,e)=>{for(var t in e||(e={}))gg.call(e,t)&&pn(i,t,e[t]);if(dn)for(var t of dn(e))yg.call(e,t)&&pn(i,t,e[t]);return i},bg=(i,e)=>dg(i,pg(e));class ts{constructor(e){this.events=new Nr,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:di(xe.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||ln}))}static async init(e){const t=new ts(e);return await t.initialize(),t}async request(e,t){const[r,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:gn({},e),chainId:`${r}:${s}`,topic:this.session.topic})}sendAsync(e,t,r){this.request(e,r).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:He("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:t}=e;return this.setNamespaces(t),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return t&&(this.uri=t,this.events.emit("display_uri",t)),this.session=await r(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,t){try{const[r,s]=this.validateChain(e);this.getProvider(r).setDefaultChain(s,t)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(vi(t)){for(const r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${fn}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await es.init({logger:this.providerOpts.logger||ln,relayUrl:this.providerOpts.relayUrl||hg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new ng({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new ag({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new og({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new cg({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:r}=t;r.name==="accountsChanged"?this.events.emit("accountsChanged",r.data):r.name==="chainChanged"?this.onChainChanged(r.data,t.chainId):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r;const{namespaces:s}=t,o=(r=this.client)==null?void 0:r.session.get(e);this.session=bg(gn({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${fn}/namespaces`,e),this.namespaces=e}validateChain(e){const[t,r]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);return!t||!r?rg(this.namespaces):[t,r]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t){const[r,s]=this.validateChain(t);this.getProvider(r).setDefaultChain(s),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const Dg=ts;export{Dg as UniversalProvider,ts as default};
